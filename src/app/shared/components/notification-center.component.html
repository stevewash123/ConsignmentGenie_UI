<div class="notifications-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>üîî Notifications</h1>
      <p class="header-subtitle">Stay up to date with your consignment activity</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="markAllAsRead()" [disabled]="unreadCount() === 0">
        ‚úì Mark All Read
      </button>
    </div>
  </div>

  <!-- Main Content Container -->
  <div class="notifications-container">
    <!-- Filters Bar -->
    <div class="filters-bar">
      <div class="filter-group">
        <label for="typeFilter">Type:</label>
        <select
          id="typeFilter"
          [(ngModel)]="selectedType"
          (change)="applyFilters()"
          class="filter-select">
          <option value="">All Types</option>
          <option value="manifest">Manifest Submitted</option>
          <option value="payout">Payout Ready</option>
          <option value="sale">Item Sold</option>
          <option value="expiring">Items Expiring</option>
          <option value="agreement">Agreement Update</option>
          <option value="system">System Message</option>
        </select>
      </div>

      <div class="filter-group search-group">
        <label for="searchInput">Search:</label>
        <input
          id="searchInput"
          type="text"
          [(ngModel)]="searchQuery"
          (keyup.enter)="applyFilters()"
          placeholder="Search notifications..."
          class="filter-input">
      </div>

      <div class="filter-group">
        <label for="fromDate">From:</label>
        <input
          id="fromDate"
          type="date"
          [(ngModel)]="fromDate"
          (change)="applyFilters()"
          class="filter-input date-input">
      </div>

      <div class="filter-group">
        <label for="toDate">To:</label>
        <input
          id="toDate"
          type="date"
          [(ngModel)]="toDate"
          (change)="applyFilters()"
          class="filter-input date-input">
      </div>

      <div class="filter-group checkbox-filter">
        <label class="checkbox-label">
          <input
            type="checkbox"
            [(ngModel)]="showUnreadOnly"
            (change)="applyFilters()"
            class="checkbox-input">
          <span>Show Unread Only</span>
        </label>
      </div>
    </div>

    <!-- Notifications List -->
    <div class="notifications-list" *ngIf="!isLoading() && notifications().length > 0">
      <div
        class="notification-card"
        *ngFor="let notification of notifications(); trackBy: trackById"
        [class.unread]="!notification.isRead"
        [class.read]="notification.isRead">

        <!-- Date Header (top-left, prominent) -->
        <div class="notification-date">
          <span class="date-text">{{ formatDate(notification.createdAt) }}</span>
          <span class="time-text">{{ formatTime(notification.createdAt) }}</span>
        </div>

        <!-- Main Content Row -->
        <div class="notification-content">
          <!-- Type Icon -->
          <div class="notification-icon" [ngClass]="'icon-' + notification.type">
            {{ getNotificationIcon(notification.type) }}
          </div>

          <!-- Message Content -->
          <div class="notification-body">
            <div class="notification-title">{{ notification.title }}</div>
            <div class="notification-message">{{ notification.message }}</div>
            <div class="notification-meta" *ngIf="notification.metadata">
              <span class="meta-item" *ngIf="notification.metadata.itemCount">
                {{ notification.metadata.itemCount }} items
              </span>
              <span class="meta-item" *ngIf="notification.metadata.totalValue">
                {{ notification.metadata.totalValue | currency }}
              </span>
              <span class="meta-item" *ngIf="notification.metadata.consignorName">
                {{ notification.metadata.consignorName }}
              </span>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="notification-actions">
            <!-- Mark as Read/Unread -->
            <button
              class="btn-icon"
              [class.read-btn]="!notification.isRead"
              [class.unread-btn]="notification.isRead"
              (click)="toggleReadStatus(notification)"
              [title]="notification.isRead ? 'Mark as unread' : 'Mark as read'">
              {{ notification.isRead ? 'üì≠' : 'üì¨' }}
            </button>

            <!-- Primary Action (if applicable) -->
            <button
              class="btn-icon action-btn"
              *ngIf="notification.actionUrl"
              (click)="handleAction(notification)"
              [title]="getActionButtonTooltip(notification)">
              {{ getActionButtonText(notification) }}
            </button>

            <!-- Delete -->
            <button
              class="btn-icon delete-btn"
              (click)="deleteNotification(notification)"
              title="Delete notification">
              üóëÔ∏è
            </button>
          </div>
        </div>

        <!-- Unread Indicator -->
        <div class="unread-indicator" *ngIf="!notification.isRead"></div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading()">
      <div class="loading-spinner"></div>
      <p>Loading notifications...</p>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading() && notifications().length === 0">
      <div class="empty-icon">üîî</div>
      <h3>No notifications</h3>
      <p *ngIf="hasActiveFilters()">No notifications match your current filters. Try adjusting your search criteria.</p>
      <p *ngIf="!hasActiveFilters()">You're all caught up! New notifications will appear here.</p>
      <button class="btn-secondary" *ngIf="hasActiveFilters()" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages() > 1">
      <button
        class="page-btn"
        [disabled]="currentPage() === 1"
        (click)="goToPage(currentPage() - 1)">
        Previous
      </button>
      <div class="page-numbers">
        <button
          class="page-btn"
          *ngFor="let page of getPageNumbers()"
          [class.active]="page === currentPage()"
          (click)="goToPage(page)">
          {{ page }}
        </button>
      </div>
      <button
        class="page-btn"
        [disabled]="currentPage() === totalPages()"
        (click)="goToPage(currentPage() + 1)">
        Next
      </button>
    </div>
  </div>

  <!-- Notification Preferences Link -->
  <div class="preferences-link">
    <a routerLink="/settings/notifications">
      ‚öôÔ∏è Notification Preferences
    </a>
  </div>
</div>
