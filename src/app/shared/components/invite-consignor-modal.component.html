
    <div class="modal-overlay" (click)="close()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ mode === 'invite' ? labels.inviteProvider : labels.addProviderManually }}</h2>
          <button class="close-btn" (click)="close()">×</button>
        </div>

        <div class="modal-body">
          <!-- Email Invite Mode -->
          <div *ngIf="mode === 'invite'">
            <p class="description">
              Send an invitation email to your consignor. They'll create
              their own account and be linked to your shop.
            </p>

            <form [formGroup]="inviteForm" (ngSubmit)="submitInvite()">
              <div class="form-group">
                <label for="email">Email Address</label>
                <input
                  id="email"
                  type="email"
                  formControlName="email"
                  class="form-input"
                  [class.error]="inviteForm.get('email')?.invalid && inviteForm.get('email')?.touched"
                />
                <div *ngIf="inviteForm.get('email')?.invalid && inviteForm.get('email')?.touched" class="error-text">
                  Email address is required
                </div>
              </div>

              <div class="form-group">
                <label for="firstName">First Name (optional)</label>
                <input
                  id="firstName"
                  type="text"
                  formControlName="firstName"
                  class="form-input"
                />
              </div>

              <div class="form-group">
                <label for="lastName">Last Name (optional)</label>
                <input
                  id="lastName"
                  type="text"
                  formControlName="lastName"
                  class="form-input"
                />
              </div>

              <div class="form-group">
                <label for="personalMessage">Personal Message (optional)</label>
                <textarea
                  id="personalMessage"
                  formControlName="personalMessage"
                  class="form-textarea"
                  rows="3"
                  placeholder="Hi! I'd like to invite you to consign with us..."
                ></textarea>
              </div>

              <div class="mode-switch">
                <button type="button" class="link-btn" (click)="switchToManual()">
                  Or add consignor manually (without email invite)
                </button>
              </div>

              <div class="modal-actions">
                <button type="button" class="btn-secondary" (click)="close()">
                  Cancel
                </button>
                <button
                  type="submit"
                  class="btn-primary"
                  [disabled]="inviteForm.invalid || isSubmitting()"
                >
                  {{ isSubmitting() ? 'Sending...' : 'Send Invitation' }}
                </button>
              </div>
            </form>
          </div>

          <!-- Manual Add Mode -->
          <div *ngIf="mode === 'manual'">
            <p class="description">
              Create a consignor account directly. They won't receive an
              invitation email — you can share login details with them.
            </p>

            <form [formGroup]="manualForm" (ngSubmit)="submitManual()">
              <div class="form-group">
                <label for="manualFirstName">First Name *</label>
                <input
                  id="manualFirstName"
                  type="text"
                  formControlName="firstName"
                  class="form-input"
                  [class.error]="manualForm.get('firstName')?.invalid && manualForm.get('firstName')?.touched"
                />
                <div *ngIf="manualForm.get('firstName')?.invalid && manualForm.get('firstName')?.touched" class="error-text">
                  First name is required
                </div>
              </div>

              <div class="form-group">
                <label for="manualLastName">Last Name *</label>
                <input
                  id="manualLastName"
                  type="text"
                  formControlName="lastName"
                  class="form-input"
                  [class.error]="manualForm.get('lastName')?.invalid && manualForm.get('lastName')?.touched"
                />
                <div *ngIf="manualForm.get('lastName')?.invalid && manualForm.get('lastName')?.touched" class="error-text">
                  Last name is required
                </div>
              </div>

              <div class="form-group">
                <label for="manualEmail">Email Address *</label>
                <input
                  id="manualEmail"
                  type="email"
                  formControlName="email"
                  class="form-input"
                  [class.error]="manualForm.get('email')?.invalid && manualForm.get('email')?.touched"
                />
                <div *ngIf="manualForm.get('email')?.invalid && manualForm.get('email')?.touched" class="error-text">
                  Valid email address is required
                </div>
              </div>

              <div class="form-group">
                <label for="manualPhone">Phone (optional)</label>
                <input
                  id="manualPhone"
                  type="tel"
                  formControlName="phone"
                  class="form-input"
                />
              </div>

              <div class="form-group">
                <div class="commission-group">
                  <label for="commissionRate">Commission Rate (%) *</label>
                  <label class="checkbox-label">
                    <input
                      type="checkbox"
                      formControlName="useShopDefault"
                      (change)="onUseShopDefaultChange()"
                    />
                    Use shop default
                  </label>
                </div>
                <input
                  id="commissionRate"
                  type="number"
                  formControlName="commissionRate"
                  class="form-input"
                  min="0"
                  max="100"
                  [class.error]="manualForm.get('commissionRate')?.invalid && manualForm.get('commissionRate')?.touched"
                />
                <div *ngIf="manualForm.get('commissionRate')?.invalid && manualForm.get('commissionRate')?.touched" class="error-text">
                  Commission rate is required
                </div>
              </div>

              <div class="mode-switch">
                <button type="button" class="link-btn" (click)="switchToInvite()">
                  ← Back to email invite
                </button>
              </div>

              <div class="modal-actions">
                <button type="button" class="btn-secondary" (click)="close()">
                  Cancel
                </button>
                <button
                  type="submit"
                  class="btn-primary"
                  [disabled]="manualForm.invalid || isSubmitting()"
                >
                  {{ isSubmitting() ? 'Adding...' : 'Add Consignor' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  