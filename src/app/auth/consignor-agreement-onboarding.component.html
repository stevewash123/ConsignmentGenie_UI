<div class="agreement-onboarding-container">
  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading agreement requirements...</p>
  </div>

  <!-- Agreement Flow (Both Acknowledge and Upload) -->
  <div *ngIf="!isLoading() && agreementStatus()?.required" class="agreement-card">
    <div class="agreement-header">
      <h1>Almost there!</h1>
      <p *ngIf="shopName()">
        Please review and accept the consignment terms for<br>
        <strong>{{ shopName() }}</strong>
      </p>
      <p *ngIf="!shopName()">
        Please review and accept the consignment terms
      </p>
    </div>

    <!-- Terms Content (Always shown) -->
    <div class="terms-content">
      <div class="terms-text">
        {{ acknowledgeTermsText() }}
      </div>
    </div>

    <!-- Agreement Download (Always available) -->
    <div class="download-section">
      <button type="button" class="btn btn-secondary btn-small" (click)="downloadTemplate()">
        <span class="btn-icon">ðŸ“„</span>
        Download Agreement PDF
      </button>
    </div>

    <!-- Upload Section (Only for upload mode) -->
    <div *ngIf="agreementStatus()?.type === 'upload'" class="upload-section">
      <h3>Upload Signed Agreement</h3>
      <p class="upload-instructions">
        After downloading, print and sign the agreement, then upload it here:
      </p>

      <div class="upload-area">
        <div class="file-upload-container" [class.has-file]="selectedFile()">
          <div class="file-upload-content" *ngIf="!selectedFile()">
            <div class="upload-icon">ðŸ“„</div>
            <p>Drag and drop your signed agreement here</p>
            <p class="upload-subtext">or click to browse</p>
            <p class="file-requirements">PDF, PNG, JPG up to 10MB</p>
          </div>

          <div class="selected-file-info" *ngIf="selectedFile()">
            <div class="file-icon">ðŸ“„</div>
            <div class="file-details">
              <span class="file-name">{{ selectedFile()!.name }}</span>
              <span class="file-size">{{ (selectedFile()!.size / 1024 / 1024).toFixed(2) }} MB</span>
            </div>
            <button type="button" class="btn btn-link btn-small" (click)="selectedFile.set(null)">
              Remove
            </button>
          </div>

          <input
            type="file"
            id="agreementFile"
            (change)="onFileSelected($event)"
            accept=".pdf,.png,.jpg,.jpeg"
            style="display: none;">

          <label for="agreementFile" class="file-upload-overlay" *ngIf="!selectedFile()"></label>
        </div>

        <!-- Optional notes -->
        <div class="form-group" *ngIf="selectedFile()">
          <label for="uploadNotes">Notes (optional)</label>
          <textarea
            id="uploadNotes"
            [(ngModel)]="uploadNotes"
            class="form-textarea"
            placeholder="Any additional notes about this agreement"
            rows="2"></textarea>
        </div>

        <!-- Upload progress -->
        <div class="upload-progress" *ngIf="uploadProgress() > 0">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="uploadProgress()"></div>
          </div>
          <span>{{ uploadProgress() }}%</span>
        </div>
      </div>

      <div class="alternative-option">
        <div class="divider">
          <span>or</span>
        </div>
        <p>Signing in person? Let the shop know and they can mark your agreement as received.</p>
      </div>
    </div>

    <!-- Terms Acceptance (Always required) -->
    <div class="agreement-acceptance">
      <label class="checkbox-container">
        <input
          type="checkbox"
          [(ngModel)]="isTermsAccepted"
          [disabled]="isProcessing()">
        <span class="checkmark"></span>
        I have read and agree to these terms
      </label>
    </div>

    <!-- Action Buttons -->
    <div class="agreement-actions">
      <!-- Skip button only for upload mode -->
      <button
        *ngIf="agreementStatus()?.type === 'upload'"
        type="button"
        class="btn btn-secondary"
        (click)="skipForNow()"
        [disabled]="isProcessing()">
        Skip for Now
      </button>

      <!-- Continue/Upload button -->
      <button
        type="button"
        class="btn btn-primary"
        (click)="submitAgreement()"
        [disabled]="!isTermsAccepted() || (agreementStatus()?.type === 'upload' && !selectedFile()) || isProcessing()">
        <ng-container *ngIf="agreementStatus()?.type === 'acknowledge'">
          {{ isProcessing() ? 'Processing...' : 'Continue' }}
        </ng-container>
        <ng-container *ngIf="agreementStatus()?.type === 'upload'">
          {{ isProcessing() ? 'Uploading...' : 'Upload & Continue' }}
        </ng-container>
      </button>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage()" class="success-message">
      âœ“ {{ successMessage() }}
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage()" class="error-message">
      {{ errorMessage() }}
    </div>
  </div>
</div>