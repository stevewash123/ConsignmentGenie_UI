<div class="cart-container">
  <!-- Header -->
  <div class="cart-header">
    <h3>Cart</h3>
    @if (cartItems().length > 0) {
      <span class="item-count">{{ cartItems().length }} item{{ cartItems().length > 1 ? 's' : '' }}</span>
    }
  </div>

  <!-- Cart Items -->
  <div class="cart-items">
    @if (cartItems().length === 0) {
      <div class="empty-cart">
        <i class="fas fa-shopping-cart"></i>
        <p>Your cart is empty</p>
        <small>Add items from the search panel</small>
      </div>
    } @else {
      @for (cartItem of cartItems(); track cartItem.item.id || cartItem.item.sku || $index) {
        <div class="cart-item" [class.reserved]="cartItem.reservation?.isActive">
          <div class="item-info">
            <div class="item-name">{{ cartItem.item.name }}</div>
            <div class="item-sku">{{ cartItem.item.sku }}</div>
            <div class="item-consignor">{{ cartItem.item.consignorName }}</div>

            <!-- Square Status -->
            @if (cartItem.item.isFromSquare) {
              @if (cartItem.reservation?.isActive) {
                <div class="reservation-note">Reserved from online sales</div>
              } @else {
                <div class="unreserved-note">Available online</div>
              }
            }
          </div>

          <!-- Reservation Timer -->
          @if (cartItem.reservation?.isActive && getTimeRemaining(cartItem.item.id) !== undefined) {
            <div class="reservation-status">
              <div class="timer" [class.warning]="isTimerWarning(cartItem.item.id)">
                <i class="fas fa-clock"></i>
                <span class="time">{{ formatTime(getTimeRemaining(cartItem.item.id)!) }}</span>
              </div>
            </div>
          }

          <div class="item-actions">
            <div class="item-price">${{ cartItem.item.price | number:'1.2-2' }}</div>
            <button
              class="remove-button"
              (click)="removeItem(cartItem.item.id)"
              title="Remove from cart"
              type="button">
              Ã—
            </button>
          </div>
        </div>
      }
    }
  </div>

  <!-- Totals Section -->
  @if (cartItems().length > 0) {
    <div class="totals-section">
      <div class="totals-line">
        <span>Subtotal:</span>
        <span class="amount">${{ subtotal() | number:'1.2-2' }}</span>
      </div>
      <div class="totals-line">
        <span>Tax ({{ (taxRate() * 100) | number:'1.1-1' }}%):</span>
        <span class="amount">${{ taxAmount() | number:'1.2-2' }}</span>
      </div>
      <div class="totals-line total-line">
        <span>TOTAL:</span>
        <span class="amount total-amount">${{ total() | number:'1.2-2' }}</span>
      </div>
    </div>
  }

  <!-- Payment Section -->
  <div class="payment-section">
    <div class="payment-type">
      <label for="paymentType">Payment Type:</label>
      <select
        id="paymentType"
        [ngModel]="selectedPaymentType()"
        (ngModelChange)="onPaymentTypeChange($event)"
        class="payment-select">
        <option value="Cash">Cash</option>
        <option value="Card">Card</option>
        <option value="Check">Check</option>
        <option value="Other">Other</option>
      </select>
    </div>

    <div class="customer-email">
      <label for="customerEmail">Customer Email (optional):</label>
      <input
        type="email"
        id="customerEmail"
        [ngModel]="customerEmail()"
        (ngModelChange)="onCustomerEmailChange($event)"
        placeholder="customer@email.com"
        class="email-input">
    </div>
  </div>

  <!-- Complete Sale Button -->
  <div class="complete-section">
    <button
      class="complete-button"
      type="button"
      [disabled]="isLoading() || cartItems().length === 0"
      (click)="onCompleteSale()">
      @if (isLoading()) {
        <i class="fas fa-spinner fa-spin"></i>
        Processing...
      } @else {
        <i class="fas fa-check"></i>
        Complete Sale
      }
    </button>
  </div>
</div>
