
    <app-owner-layout>
      <div class="inventory-page">
        <!-- Header -->
        <div class="page-header">
          <div class="header-content">
            <h1>Inventory Management</h1>
            <p>View and manage all inventory items</p>
          </div>
          <div class="header-actions">
            <button class="btn-secondary" (click)="openBulkImport()" title="Upload multiple items at once">
              <span class="btn-icon">üì§</span>
              Bulk Upload
            </button>
            <button class="btn-primary" (click)="createNewItem()">
              <span class="btn-icon">üì¶</span>
              Add New Item
            </button>
          </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
          <div class="filter-row">
            <div class="filter-group">
              <label for="searchQuery">Search</label>
              <input
                type="text"
                id="searchQuery"
                [(ngModel)]="searchQuery"
                (keyup.enter)="applyFilters()"
                placeholder="Search items by title, SKU, or description..."
                class="filter-input">
            </div>
            <div class="filter-group">
              <label for="selectedStatus">Status</label>
              <select id="selectedStatus" [(ngModel)]="selectedStatus" (change)="applyFilters()" class="filter-select">
                <option value="">All Statuses</option>
                <option value="Available">Available</option>
                <option value="Sold">Sold</option>
                <option value="Removed">Removed</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="selectedCondition">Condition</label>
              <select id="selectedCondition" [(ngModel)]="selectedCondition" (change)="applyFilters()" class="filter-select">
                <option value="">All Conditions</option>
                <option value="New">New</option>
                <option value="LikeNew">Like New</option>
                <option value="Good">Good</option>
                <option value="Fair">Fair</option>
                <option value="Poor">Poor</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="selectedCategory">Category</label>
              <select id="selectedCategory" [(ngModel)]="selectedCategory" (change)="applyFilters()" class="filter-select">
                <option value="">All Categories</option>
                @for (category of categories(); track category.id) {
                  <option [value]="category.name">{{ category.name }}</option>
                }
              </select>
            </div>
            <div class="filter-group">
              <label for="selectedExpiration">Expiration</label>
              <select id="selectedExpiration" [(ngModel)]="selectedExpiration" (change)="applyFilters()" class="filter-select">
                <option value="">All Items</option>
                <option value="expiring-soon">‚ö†Ô∏è Expiring Soon (‚â§7 days)</option>
                <option value="expired">üî¥ Expired</option>
                <option value="this-month">This Month</option>
                <option value="next-month">Next Month</option>
              </select>
            </div>
            <button class="btn-secondary" (click)="clearFilters()">
              Clear Filters
            </button>
          </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
          <div class="section-header">
            <h2>Inventory Items</h2>
            <div class="header-controls">
              <button class="legend-toggle" (click)="openColorGuideModal()" type="button">
                <span class="legend-icon">üé®</span>
                Color Guide
              </button>
              <select [(ngModel)]="pageSize" (change)="changePageSize()" class="page-size-select">
                <option value="10">10 per page</option>
                <option value="25">25 per page</option>
                <option value="50">50 per page</option>
                <option value="100">100 per page</option>
              </select>
            </div>
          </div>


          <div class="table-container" *ngIf="!isInventoryLoading() && pagedResult(); else loadingInventory">
            <table class="inventory-table compact-design">
              <thead>
                <tr>
                  <th>Image</th>
                  <th (click)="setSorting('title')" class="sortable">
                    Title / SKU
                    <span class="sort-indicator" [class.active]="sortBy === 'title'">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </th>
                  <th>Category / Status</th>
                  <th (click)="setSorting('price')" class="sortable">
                    Price / Condition
                    <span class="sort-indicator" [class.active]="sortBy === 'price'">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </th>
                  <th>Consignor</th>
                  <th (click)="setSorting('receivedDate')" class="sortable">
                    Received / Expires
                    <span class="sort-indicator" [class.active]="sortBy === 'receivedDate'">
                      {{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}
                    </span>
                  </th>
                  <th class="actions-cell">Actions</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let item of itemsResult()!.items; let i = index">
                  <!-- Main item row -->
                  <tr class="item-row" [class.even]="i % 2 === 0">
                    <!-- Image -->
                    <td class="image-cell">
                      @if (item.primaryImageUrl) {
                        <img [src]="item.primaryImageUrl" [alt]="item.title" class="item-thumbnail">
                      } @else {
                        <div class="no-image">
                          üì∑
                        </div>
                      }
                    </td>

                    <!-- Title w/ SKU below -->
                    <td class="title-sku-cell">
                      <div class="item-title"
                           [title]="item.description || null">{{ item.title }}</div>
                      <div class="item-sku">{{ item.sku }}</div>
                    </td>

                    <!-- Category / Status -->
                    <td class="category-status-cell">
                      <div class="category">{{ item.category }}</div>
                      <div class="status">
                        <span class="status-badge" [class]="'status-' + item.status.toLowerCase()">
                          {{ item.status }}
                        </span>
                      </div>
                    </td>

                    <!-- Price / Condition -->
                    <td class="price-condition-cell">
                      <div class="item-price">${{ item.price | number:'1.2-2' }}</div>
                      <div class="condition">
                        <span class="condition-badge" [class]="getConditionClass(item.condition)">
                          {{ getConditionLabel(item.condition) }}
                        </span>
                      </div>
                    </td>

                    <!-- Consignor -->
                    <td class="consignor-cell">
                      <div class="consignor-name"
                           [class.clickable]="item.consignorId"
                           (click)="viewConsignor(item.consignorId)"
                           [title]="item.consignorId ? 'Click to view consignor details' : ''">
                        {{ item.consignorName || 'Unassigned' }}
                      </div>
                    </td>

                    <!-- Received / Expires -->
                    <td class="dates-cell">
                      <div class="received-date">{{ item.receivedDate | date:'MMM d, y' }}</div>
                      <div class="expires-date" [class]="getExpirationStatusClass(item.expirationDate)">
                        {{ getExpirationDisplayText(item.expirationDate) }}
                      </div>
                    </td>

                    <!-- Actions -->
                    <td class="actions-cell">
                      <div class="action-buttons">
                        <button class="btn-icon" (click)="viewItem(item.itemId)" title="View Details">
                          üëÅÔ∏è
                        </button>
                        <button class="btn-icon" (click)="editItem(item.itemId)" title="Edit">
                          ‚úèÔ∏è
                        </button>
                        @if (item.status === 'Available') {
                          <button class="btn-icon" (click)="markAsRemoved(item)" title="Mark as Removed">
                            üì¶
                          </button>
                        }
                        <button class="btn-icon danger" (click)="deleteItem(item)" title="Delete">
                          üóëÔ∏è
                        </button>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>

            <!-- Pagination -->
            <div class="pagination" *ngIf="itemsResult()!.totalPages > 1">
              <button
                class="page-btn"
                [disabled]="currentPage() === 1"
                (click)="goToPage(currentPage() - 1)">
                Previous
              </button>

              <div class="page-numbers">
                <button
                  *ngFor="let page of visiblePages()"
                  class="page-btn"
                  [class.active]="page === currentPage()"
                  (click)="goToPage(page)">
                  {{ page }}
                </button>
              </div>

              <button
                class="page-btn"
                [disabled]="currentPage() === itemsResult()!.totalPages"
                (click)="goToPage(currentPage() + 1)">
                Next
              </button>
            </div>
          </div>

          <ng-template #loadingInventory>
            <div class="loading-state" *ngIf="isInventoryLoading()">
              <div class="loading-spinner"></div>
              <p>Loading inventory...</p>
            </div>
            <div class="empty-state" *ngIf="!isInventoryLoading() && (!itemsResult() || itemsResult()!.items.length === 0)">
              <p>No inventory items found.</p>
              <button class="btn-primary" (click)="createNewItem()">
                <span class="btn-icon">üì¶</span>
                Add Your First Item
              </button>
            </div>
          </ng-template>
        </div>

      </div>
    </app-owner-layout>

    <!-- Bulk Import Modal -->
    <app-bulk-import-modal
      [isOpen]="isBulkImportModalOpen()"
      (closeModal)="closeBulkImportModal()"
      (itemsImported)="onItemsImported($event)">
    </app-bulk-import-modal>

    <!-- Color Guide Modal -->
    <div class="modal-overlay" *ngIf="isColorGuideModalOpen()" (click)="closeColorGuideModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3 class="modal-title">Color Guide</h3>
          <button class="modal-close-btn" (click)="closeColorGuideModal()">√ó</button>
        </div>

        <div class="modal-legend-section">
          <h4>Item Condition</h4>
          <div class="modal-legend-items">
            <div class="modal-legend-item">
              <span class="condition-badge condition-new">NEW</span>
              <span class="modal-legend-text">Perfect/Unused</span>
            </div>
            <div class="modal-legend-item">
              <span class="condition-badge condition-like-new">LIKE NEW</span>
              <span class="modal-legend-text">Excellent</span>
            </div>
            <div class="modal-legend-item">
              <span class="condition-badge condition-good">GOOD</span>
              <span class="modal-legend-text">Good quality</span>
            </div>
            <div class="modal-legend-item">
              <span class="condition-badge condition-fair">FAIR</span>
              <span class="modal-legend-text">Some wear</span>
            </div>
            <div class="modal-legend-item">
              <span class="condition-badge condition-poor">POOR</span>
              <span class="modal-legend-text">Heavy wear</span>
            </div>
          </div>
        </div>

        <div class="modal-legend-section">
          <h4>Item Status</h4>
          <div class="modal-legend-items">
            <div class="modal-legend-item">
              <span class="status-badge status-available">AVAILABLE</span>
              <span class="modal-legend-text">Ready for sale</span>
            </div>
            <div class="modal-legend-item">
              <span class="status-badge status-sold">SOLD</span>
              <span class="modal-legend-text">Successfully sold</span>
            </div>
            <div class="modal-legend-item">
              <span class="status-badge status-removed">REMOVED</span>
              <span class="modal-legend-text">No longer available</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  