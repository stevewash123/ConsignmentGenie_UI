
<app-owner-layout>
<div class="inventory-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Inventory Management</h1>
    <div class="header-buttons">
      <button class="bulk-upload-button" (click)="openBulkUpload()">
        üì§ Bulk Upload
      </button>
      <button class="add-button" (click)="createNewItem()">
        üì¶ Add New Item
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-row">
      <!-- Search and Sort -->
      <div class="search-sort-container">
        <div class="search-container">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            class="search-input"
            placeholder="Search items by title, SKU, or description..."
            [(ngModel)]="searchQuery"
            (input)="applyFilters()">
        </div>

        <select class="filter-select" [(ngModel)]="sortBy" (change)="setSorting(sortBy)">
          <option value="receivedDate">Newest First</option>
          <option value="title">Title A-Z</option>
          <option value="price">Price: High to Low</option>
          <option value="sku">SKU</option>
        </select>
      </div>

      <!-- Status Filters -->
      <div class="status-filters">
        <select class="filter-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="">All Statuses</option>
          <option value="Available">Available</option>
          <option value="Sold">Sold</option>
          <option value="Removed">Removed</option>
        </select>

        <select class="filter-select" [(ngModel)]="selectedCondition" (change)="applyFilters()">
          <option value="">All Conditions</option>
          <option value="New">New</option>
          <option value="LikeNew">Like New</option>
          <option value="Good">Good</option>
          <option value="Fair">Fair</option>
          <option value="Poor">Poor</option>
        </select>

        <select class="filter-select" [(ngModel)]="selectedCategory" (change)="applyFilters()">
          <option value="">All Categories</option>
          @for (category of categories(); track category.Id) {
            <option [value]="category.Name">{{ category.Name }}</option>
          }
        </select>
      </div>

      <button class="clear-button" (click)="clearFilters()">Clear Filters</button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="isInventoryLoading()">
    <p>Loading inventory...</p>
  </div>

  <!-- Inventory Content -->
  <div *ngIf="!isInventoryLoading()">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="!itemsResult() || !itemsResult()!.Items || itemsResult()!.Items.length === 0">
      <div class="empty-state-icon">üì¶</div>
      <div class="empty-state-title">No Inventory Items Found</div>
      <div class="empty-state-description">
        Start adding items to your inventory to manage your consignment business.
      </div>
      <button class="empty-state-button" (click)="createNewItem()">
        üì¶ Add Your First Item
      </button>
    </div>

    <!-- Inventory List -->
    <div *ngIf="itemsResult() && itemsResult()!.Items && itemsResult()!.Items.length > 0">
      <!-- Content Header -->
      <div class="content-header">
        <div class="results-info">
          Showing {{ ((currentPage() - 1) * pageSize) + 1 }}-{{ Math.min(currentPage() * pageSize, itemsResult()!.TotalCount) }} of {{ itemsResult()!.TotalCount }} items
        </div>
        <select [(ngModel)]="pageSize" (change)="changePageSize()" class="page-size-select">
          <option value="10">10 per page</option>
          <option value="25">25 per page</option>
          <option value="50">50 per page</option>
          <option value="100">100 per page</option>
        </select>
      </div>

      <!-- Inventory Cards -->
      <div class="inventory-list">
        <div class="inventory-card" *ngFor="let item of itemsResult()!.Items">
          <img
            [src]="item.PrimaryImageUrl || 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=80&h=80&fit=crop'"
            [alt]="item.Title"
            class="inventory-thumbnail">

          <div class="inventory-info">
            <div class="inventory-header">
              <h3 class="inventory-title">{{ item.Title }}</h3>
              <div class="inventory-badges">
                <span class="status-badge" [class]="'status-' + item.Status.toLowerCase()">
                  {{ item.Status }}
                </span>
                <span class="condition-badge" [class]="getConditionClass(item.Condition)">
                  {{ getConditionLabel(item.Condition) }}
                </span>
              </div>
            </div>
            <div class="inventory-meta">
              <div class="meta-row">
                <span class="meta-label">SKU:</span>
                <span class="meta-value">{{ item.Sku }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Category:</span>
                <span class="meta-value">{{ item.Category }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Consignor:</span>
                <span class="meta-value">{{ item.ConsignorName }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Received:</span>
                <span class="meta-value">{{ item.ReceivedDate | date:'MMM d, y' }}</span>
              </div>
            </div>
            <div class="inventory-price">
              ${{ item.Price | number:'1.2-2' }}
            </div>
          </div>

          <div class="inventory-actions">
            <button class="action-button primary" (click)="viewItem(item.ItemId)" title="View Details">
              üëÅÔ∏è View
            </button>
            <button class="action-button" (click)="editItem(item.ItemId)" title="Edit">
              ‚úèÔ∏è Edit
            </button>
            @if (item.Status === 'Available') {
              <button class="action-button" (click)="markAsRemoved(item)" title="Mark as Removed">
                üì¶ Remove
              </button>
            }
            <button class="action-button danger" (click)="deleteItem(item)" title="Delete">
              üóëÔ∏è Delete
            </button>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination" *ngIf="itemsResult()!.TotalPages > 1">
        <div class="pagination-info">
          Showing {{ ((currentPage() - 1) * pageSize) + 1 }}-{{ Math.min(currentPage() * pageSize, itemsResult()!.TotalCount) }} of {{ itemsResult()!.TotalCount }} items
        </div>
        <div class="pagination-controls">
          <button
            class="pagination-button"
            [class.disabled]="currentPage() === 1"
            (click)="goToPage(currentPage() - 1)"
            [disabled]="currentPage() === 1">
            Previous
          </button>
          <button
            class="pagination-button"
            *ngFor="let page of visiblePages()"
            [class.active]="page === currentPage()"
            (click)="goToPage(page)">
            {{ page }}
          </button>
          <button
            class="pagination-button"
            [class.disabled]="currentPage() === itemsResult()!.TotalPages"
            (click)="goToPage(currentPage() + 1)"
            [disabled]="currentPage() === itemsResult()!.TotalPages">
            Next
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Item Modal -->
<app-item-form-modal
  [isOpen]="isAddModalOpen"
  [editingItem]="null"
  (closeModal)="closeAddModal()"
  (itemSaved)="onItemSaved($event)">
</app-item-form-modal>

<!-- Edit Item Modal -->
<app-item-form-modal
  [isOpen]="isEditModalOpen"
  [editingItem]="editingItem"
  (closeModal)="closeEditModal()"
  (itemSaved)="onItemSaved($event)">
</app-item-form-modal>

<!-- Bulk Import Modal -->
<app-bulk-import-modal
  [isOpen]="isBulkImportModalOpen"
  (closeModal)="closeBulkImportModal()"
  (itemsImported)="onItemsImported($event)">
</app-bulk-import-modal>
</app-owner-layout>
