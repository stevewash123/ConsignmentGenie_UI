
<app-owner-layout>
<div class="inventory-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Inventory Management</h1>
    <div class="header-buttons">
      <button class="bulk-upload-button" (click)="openBulkUpload()">
        üì§ Bulk Upload
      </button>
      <button class="add-button" (click)="createNewItem()">
        üì¶ Add New Item
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-row">
      <!-- Search and Sort -->
      <div class="search-sort-container">
        <div class="search-container">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            class="search-input"
            placeholder="Search items by title, SKU, or description..."
            [(ngModel)]="searchQuery"
            (input)="applyFilters()">
        </div>

        <select class="filter-select" [(ngModel)]="sortBy" (change)="setSorting(sortBy)">
          <option value="receivedDate">Newest First</option>
          <option value="title">Title A-Z</option>
          <option value="price">Price: High to Low</option>
          <option value="sku">SKU</option>
          <option value="condition">Condition</option>
        </select>
      </div>

      <!-- Status Filters -->
      <div class="status-filters">

        <select class="filter-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="">All Statuses</option>
          @for (status of statusOptions(); track status.value) {
            <option [value]="status.value">{{ getStatusEmoji(status.value) }} {{ status.label }} ({{ getStatusCount(status.value) }})</option>
          }
        </select>

        <select class="filter-select" [(ngModel)]="selectedCondition" (change)="applyFilters()">
          <option value="">All Conditions</option>
          @for (condition of conditionOptions(); track condition.value) {
            <option [value]="condition.value">{{ condition.label }}</option>
          }
        </select>

        <select class="filter-select" [(ngModel)]="selectedCategory" (change)="applyFilters()">
          <option value="">All Categories</option>
          @for (category of categories(); track category.id) {
            <option [value]="category.name">{{ category.name }}</option>
          }
        </select>

        <select class="filter-select" [(ngModel)]="selectedExpiration" (change)="applyFilters()">
          <option value="">All Items</option>
          <option value="expiring-soon">‚ö†Ô∏è Expiring Soon ({{ getExpiringSoonCount() }})</option>
          <option value="expired">üî¥ Expired ({{ getExpiredCount() }})</option>
        </select>
      </div>

      <button class="clear-button" (click)="clearFilters()">Clear Filters</button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="isInventoryLoading()">
    <p>Loading inventory...</p>
  </div>

  <!-- Inventory Content -->
  <div *ngIf="!isInventoryLoading()">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="!itemsResult() || !itemsResult()!.items || itemsResult()!.items.length === 0">
      <div class="empty-state-icon">üì¶</div>
      <div class="empty-state-title">No Inventory Items Found</div>
      <div class="empty-state-description">
        Start adding items to your inventory to manage your consignment business.
      </div>
      <button class="empty-state-button" (click)="createNewItem()">
        üì¶ Add Your First Item
      </button>
    </div>

    <!-- Inventory List -->
    <div *ngIf="itemsResult() && itemsResult()!.items && itemsResult()!.items.length > 0">
      <!-- Content Header -->
      <div class="content-header">
        <div class="results-info">
          Showing {{ ((currentPage() - 1) * pageSize) + 1 }}-{{ Math.min(currentPage() * pageSize, itemsResult()!.totalCount) }} of {{ itemsResult()!.totalCount }} items
        </div>
        <select [(ngModel)]="pageSize" (change)="changePageSize()" class="page-size-select">
          <option value="10">10 per page</option>
          <option value="25">25 per page</option>
          <option value="50">50 per page</option>
          <option value="100">100 per page</option>
        </select>
      </div>

      <!-- Inventory Cards -->
      <div class="inventory-list">
        <div class="inventory-card" *ngFor="let item of itemsResult()!.items">
          <img
            [src]="item.primaryImageUrl || 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=80&h=80&fit=crop'"
            [alt]="item.title"
            class="inventory-thumbnail">

          <div class="inventory-info">
            <div class="inventory-header">
              <h3 class="inventory-title">{{ item.title }}</h3>
              <div class="inventory-badges">
                <span class="status-badge" [class]="getStatusClass(item.status)">
                  {{ getStatusEmoji(item.status) }} {{ item.status }}
                </span>
                <span class="condition-badge" [class]="getConditionClass(item.condition)">
                  {{ getConditionLabel(item.condition) }}
                </span>
              </div>
            </div>
            <div class="inventory-meta">
              <div class="meta-row">
                <span class="meta-label">SKU:</span>
                <span class="meta-value">{{ item.sku }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Category:</span>
                <span class="meta-value">{{ item.category }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Consignor:</span>
                <span class="meta-value">{{ item.consignorName }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Received:</span>
                <span class="meta-value">{{ item.receivedDate | date:'MMM d, y' }}</span>
              </div>
              <div class="meta-row">
                <span class="meta-label">Expires:</span>
                <span class="meta-value expiration-value" [ngClass]="getExpirationClass(item)">
                  {{ getExpirationDisplay(item) }}
                </span>
              </div>
            </div>
            <div class="inventory-price">
              ${{ item.price | number:'1.2-2' }}
            </div>
          </div>

          <div class="inventory-actions">
            <button class="action-button primary" (click)="viewItem(item.itemId)" title="View Details">
              üëÅÔ∏è View
            </button>
            <button class="action-button" (click)="editItem(item.itemId)" title="Edit">
              ‚úèÔ∏è Edit
            </button>
            @for (action of getAvailableStatusActions(item.status); track action.action) {
              <button class="action-button"
                      (click)="openStatusChangeModal(item, action)"
                      [title]="action.label">
                {{ getStatusActionIcon(action.action) }} {{ action.label }}
              </button>
            }
            <button class="action-button danger" (click)="deleteItem(item)" title="Delete">
              üóëÔ∏è Delete
            </button>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination" *ngIf="itemsResult()!.totalPages > 1">
        <div class="pagination-info">
          Showing {{ ((currentPage() - 1) * pageSize) + 1 }}-{{ Math.min(currentPage() * pageSize, itemsResult()!.totalCount) }} of {{ itemsResult()!.totalCount }} items
        </div>
        <div class="pagination-controls">
          <button
            class="pagination-button"
            [class.disabled]="currentPage() === 1"
            (click)="goToPage(currentPage() - 1)"
            [disabled]="currentPage() === 1">
            Previous
          </button>
          <button
            class="pagination-button"
            *ngFor="let page of visiblePages()"
            [class.active]="page === currentPage()"
            (click)="goToPage(page)">
            {{ page }}
          </button>
          <button
            class="pagination-button"
            [class.disabled]="currentPage() === itemsResult()!.totalPages"
            (click)="goToPage(currentPage() + 1)"
            [disabled]="currentPage() === itemsResult()!.totalPages">
            Next
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Item Modal -->
<app-item-form-modal
  [isOpen]="isAddModalOpen"
  [editingItem]="null"
  (closeModal)="closeAddModal()"
  (itemSaved)="onItemSaved($event)">
</app-item-form-modal>

<!-- Edit Item Modal -->
<app-item-form-modal
  [isOpen]="isEditModalOpen"
  [editingItem]="editingItem"
  (closeModal)="closeEditModal()"
  (itemSaved)="onItemSaved($event)">
</app-item-form-modal>

<!-- Bulk Import Modal -->
<app-bulk-import-modal
  [isOpen]="isBulkImportModalOpen"
  (closeModal)="closeBulkImportModal()"
  (itemsImported)="onItemsImported($event)">
</app-bulk-import-modal>

<!-- Status Change Modal -->
<app-status-change-modal
  [isOpen]="isStatusChangeModalOpen"
  [item]="selectedItemForStatus"
  [statusAction]="selectedStatusAction"
  (closeModal)="closeStatusChangeModal()"
  (statusChanged)="onStatusChanged($event)">
</app-status-change-modal>
</app-owner-layout>
