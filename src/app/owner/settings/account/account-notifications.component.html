<div class="account-notifications-section">
  <!-- Back Navigation -->
  <div class="back-nav">
    <a routerLink="/owner/settings/account" class="back-link">‚Üê Back to Account & Security</a>
  </div>

  <!-- Header -->
  <header class="section-header">
    <h2>Account Notifications</h2>
    <p>Manage your personal notification preferences and alerts</p>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading notification settings...</p>
  </div>

  <!-- Main Content -->
  <form *ngIf="!isLoading()" [formGroup]="notificationForm" (ngSubmit)="saveNotificationSettings()">

    <!-- Quick Toggle Section -->
    <section class="quick-controls">
      <div class="quick-controls-card">
        <div class="master-toggle">
          <div class="toggle-content">
            <h3>Master Control</h3>
            <p>Quickly enable or disable all notifications</p>
          </div>
          <label class="toggle-switch">
            <input
              type="checkbox"
              [(ngModel)]="allNotificationsEnabled"
              [ngModelOptions]="{standalone: true}"
              (change)="onMasterToggleChange()">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </section>

    <!-- Delivery Methods Section -->
    <section class="delivery-methods">
      <h3>How you receive notifications</h3>

      <!-- Email Settings -->
      <div class="delivery-method-card" formGroupName="email">
        <div class="method-header">
          <div class="method-info">
            <h4>üìß Email Notifications</h4>
            <p>Receive notifications via email</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" formControlName="enabled">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="method-details" *ngIf="notificationForm.get('email.enabled')?.value">
          <div class="form-row">
            <div class="form-group">
              <label for="emailAddress">Primary Email Address</label>
              <div class="input-with-status">
                <input
                  type="email"
                  id="emailAddress"
                  formControlName="address"
                  class="form-input"
                  placeholder="your@email.com">
                <span class="verification-status verified" *ngIf="notificationForm.get('email.verified')?.value">
                  ‚úì Verified
                </span>
                <button
                  type="button"
                  class="btn-link"
                  *ngIf="!notificationForm.get('email.verified')?.value"
                  (click)="verifyEmail()">
                  Verify
                </button>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="backupEmail">Backup Email (optional)</label>
              <input
                type="email"
                id="backupEmail"
                formControlName="backupAddress"
                class="form-input"
                placeholder="backup@email.com">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="emailFrequency">Email Frequency</label>
              <select id="emailFrequency" formControlName="frequency" class="form-select">
                <option value="immediate">Immediate (as they happen)</option>
                <option value="daily">Daily digest</option>
                <option value="weekly">Weekly summary</option>
              </select>
            </div>
            <div class="form-group">
              <label for="emailFormat">Email Format</label>
              <select id="emailFormat" formControlName="format" class="form-select">
                <option value="html">Rich HTML</option>
                <option value="text">Plain text</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- SMS Settings -->
      <div class="delivery-method-card" formGroupName="sms">
        <div class="method-header">
          <div class="method-info">
            <h4>üì± SMS Notifications</h4>
            <p>Receive urgent notifications via text message</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" formControlName="enabled">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="method-details" *ngIf="notificationForm.get('sms.enabled')?.value">
          <div class="form-row">
            <div class="form-group">
              <label for="phoneNumber">Phone Number</label>
              <div class="input-with-status">
                <input
                  type="tel"
                  id="phoneNumber"
                  formControlName="phoneNumber"
                  class="form-input"
                  placeholder="+1 (555) 123-4567">
                <span class="verification-status verified" *ngIf="notificationForm.get('sms.verified')?.value">
                  ‚úì Verified
                </span>
                <button
                  type="button"
                  class="btn-link"
                  *ngIf="!notificationForm.get('sms.verified')?.value"
                  (click)="verifyPhone()">
                  Verify
                </button>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="emergencyOnly">
                <span class="checkmark"></span>
                Emergency/urgent notifications only
              </label>
              <p class="help-text">Only receive SMS for critical alerts and security issues</p>
            </div>
          </div>
        </div>
      </div>

      <!-- In-App Settings -->
      <div class="delivery-method-card" formGroupName="inApp">
        <div class="method-header">
          <div class="method-info">
            <h4>üîî In-App Notifications</h4>
            <p>Notifications within the ConsignmentGenie dashboard</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" formControlName="enabled">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="method-details" *ngIf="notificationForm.get('inApp.enabled')?.value">
          <div class="form-row">
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="pushNotifications">
                <span class="checkmark"></span>
                Browser push notifications
              </label>
              <p class="help-text">Show notifications even when the app is closed</p>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="retentionDays">Keep notifications for</label>
              <select id="retentionDays" formControlName="retentionDays" class="form-select">
                <option value="7">7 days</option>
                <option value="14">14 days</option>
                <option value="30">30 days</option>
                <option value="60">60 days</option>
                <option value="90">90 days</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Notification Categories Section -->
    <section class="categories" formGroupName="categories">
      <h3>What notifications you receive</h3>

      <div class="category-grid">
        <div class="category-card">
          <div class="category-header">
            <div class="category-info">
              <h4>üõ°Ô∏è System Alerts</h4>
              <p>Security, maintenance, and feature updates</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" formControlName="systemAlerts">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="category-examples">
            <ul>
              <li>Security alerts (failed logins, password changes)</li>
              <li>System maintenance notifications</li>
              <li>Feature announcements and updates</li>
              <li>Billing and subscription alerts</li>
            </ul>
          </div>
        </div>

        <div class="category-card">
          <div class="category-header">
            <div class="category-info">
              <h4>üíº Business Operations</h4>
              <p>Sales, inventory, and financial notifications</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" formControlName="businessOperations">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="category-examples">
            <ul>
              <li>Daily/weekly sales summaries</li>
              <li>Low inventory alerts</li>
              <li>Payout processing notifications</li>
              <li>High-value transaction alerts</li>
            </ul>
          </div>
        </div>

        <div class="category-card">
          <div class="category-header">
            <div class="category-info">
              <h4>üë• Account Management</h4>
              <p>User activity and administrative notifications</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" formControlName="accountManagement">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="category-examples">
            <ul>
              <li>New consignor registration notifications</li>
              <li>Item approval request alerts</li>
              <li>Customer inquiry notifications</li>
              <li>Support ticket updates</li>
            </ul>
          </div>
        </div>

        <div class="category-card">
          <div class="category-header">
            <div class="category-info">
              <h4>üîí Security Alerts</h4>
              <p>Critical security and authentication events</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" formControlName="securityAlerts">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="category-examples">
            <ul>
              <li>Login attempts from new devices</li>
              <li>Password changes</li>
              <li>Two-factor authentication events</li>
              <li>Account access changes</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Timing & Schedule Section -->
    <section class="schedule" formGroupName="schedule">
      <h3>When you receive notifications</h3>

      <!-- Quiet Hours -->
      <div class="schedule-card" formGroupName="quietHours">
        <div class="schedule-header">
          <div class="schedule-info">
            <h4>üåô Quiet Hours</h4>
            <p>Set times when you don't want to receive notifications</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" formControlName="enabled">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="schedule-details" *ngIf="notificationForm.get('schedule.quietHours.enabled')?.value">
          <div class="time-range">
            <div class="form-group">
              <label for="quietStart">Start Time</label>
              <input type="time" id="quietStart" formControlName="startTime" class="form-input">
            </div>
            <div class="time-separator">to</div>
            <div class="form-group">
              <label for="quietEnd">End Time</label>
              <input type="time" id="quietEnd" formControlName="endTime" class="form-input">
            </div>
          </div>
        </div>
      </div>

      <!-- Timezone -->
      <div class="schedule-card">
        <div class="schedule-header">
          <div class="schedule-info">
            <h4>üåç Timezone</h4>
            <p>Set your timezone for accurate notification timing</p>
          </div>
        </div>

        <div class="schedule-details">
          <div class="form-group">
            <label for="timezone">Timezone</label>
            <select id="timezone" formControlName="timezone" class="form-select">
              <option *ngFor="let tz of timezones" [value]="tz.value">{{ tz.label }}</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Weekend Notifications -->
      <div class="schedule-card">
        <div class="schedule-header">
          <div class="schedule-info">
            <h4>üóìÔ∏è Weekend Notifications</h4>
            <p>Choose whether to receive notifications on weekends</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" formControlName="weekendNotifications">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </section>

    <!-- Save Actions -->
    <div class="save-actions">
      <button
        type="button"
        class="btn-secondary"
        (click)="loadNotificationSettings()"
        [disabled]="isLoading() || isSaving()">
        Reset Changes
      </button>
      <button
        type="submit"
        class="btn-primary"
        [disabled]="notificationForm.invalid || isLoading() || isSaving()">
        {{ isSaving() ? 'Saving...' : 'Save Notification Settings' }}
      </button>
    </div>

  </form>

  <!-- Messages -->
  <div class="messages" *ngIf="successMessage() || errorMessage()">
    <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
    <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>
  </div>
</div>