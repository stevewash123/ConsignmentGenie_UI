<div class="agreement-template-editor">
  <div class="page-header">
    <h2>Consignment Agreement</h2>
    <p>Customize your consignment agreement with placeholders that will be automatically filled when generating agreements for consignors.</p>
  </div>

  <!-- Agreement Settings -->
  <div class="form-section">
    <h3>Consignment Agreements</h3>
    <p class="section-description">
      Configure how consignment agreements are handled with new consignors.
    </p>

    <div class="form-group">
      <label class="permission-toggle">
        <input
          type="checkbox"
          [checked]="settings()?.autoSendAgreementOnRegister || false"
          (change)="onAutoSendChange($any($event.target).checked)"
          name="autoSendOnRegistration">
        <div class="toggle-switch"></div>
        <div class="permission-content">
          <span class="permission-title">Auto-send agreement when consignor registers</span>
          <span class="permission-description">Automatically email agreement to new consignors</span>
        </div>
      </label>

      <!-- Error message when auto-send is enabled but no custom template -->
      <div class="upload-required-error auto-send-error" *ngIf="settings()?.autoSendAgreementOnRegister && !hasCustomTemplate()">
        <div class="error-icon">⚠️</div>
        <div class="error-content">
          <strong>Agreement Required:</strong> You must upload a consignment agreement file before auto-send will send agreements.
          <div class="upload-section-inline">
            <label for="auto-send-upload" class="btn-secondary">
              <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
              </svg>
              {{ isUploading() ? 'Uploading...' : 'Upload Agreement File' }}
            </label>
            <input
              id="auto-send-upload"
              type="file"
              accept=".txt,text/plain"
              (change)="onFileSelected($event)"
              [disabled]="isUploading()"
              style="display: none;">
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="permission-toggle">
        <input
          type="checkbox"
          [checked]="settings()?.requireSignedAgreement || false"
          (change)="onRequireSignedChange($any($event.target).checked)"
          name="requireBeforeItems">
        <div class="toggle-switch"></div>
        <div class="permission-content">
          <span class="permission-title">Require signed agreement before item submission</span>
          <span class="permission-description">Block item submission until agreement is on file</span>
        </div>
      </label>
    </div>
  </div>


  <!-- Agreement Preview -->
  <div class="template-preview">
    <div class="preview-header">
      <h3>Sample Consignment Agreement</h3>
      <div class="preview-description">
        <div class="view-mode-selector">
          <label class="radio-option">
            <input
              type="radio"
              name="viewMode"
              value="sample"
              [checked]="viewMode() === 'sample'"
              (change)="setViewMode('sample')">
            <span>View Sample</span>
          </label>
          <label class="radio-option">
            <input
              type="radio"
              name="viewMode"
              value="agreement"
              [checked]="viewMode() === 'agreement'"
              [disabled]="!hasCustomTemplate()"
              (change)="setViewMode('agreement')">
            <span>View Agreement</span>
          </label>
        </div>
        <div class="preview-actions">
          <button type="button" class="btn-icon-small" [disabled]="true" title="Edit Agreement (Upload Required)">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
          </button>
          <button type="button" class="btn-icon-small" (click)="downloadCurrentView()" [title]="getDownloadTooltip()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </button>
          <label for="template-upload-preview" class="btn-icon-small" title="Upload Agreement">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
            </svg>
          </label>
          <input
            id="template-upload-preview"
            type="file"
            accept=".txt,text/plain"
            (change)="onFileSelected($event)"
            [disabled]="isUploading()"
            style="display: none;">
        </div>
      </div>
    </div>

    <div class="preview-content">
      <pre class="template-preview-text">{{ getDisplayedContent() }}</pre>
    </div>
  </div>

  <!-- Legal Disclaimer -->
  <div class="legal-disclaimer">
    <div class="disclaimer-icon">⚖️</div>
    <div class="disclaimer-content">
      <h4>Legal Disclaimer</h4>
      <p>
        The sample template provided is for reference only and does not constitute legal advice.
        Consignment agreements may be subject to state and local laws. We strongly recommend
        having your agreement reviewed by a qualified attorney before use.
      </p>
    </div>
  </div>

  <!-- Messages -->
  <div class="messages" *ngIf="successMessage() || errorMessage()">
    <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
    <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>
  </div>
</div>