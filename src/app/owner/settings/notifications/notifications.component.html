<div class="notifications-section">
  <header class="section-header">
    <h2 class="section-title">Notification Settings</h2>
    <p class="section-description">Choose which notifications you want to receive and how you want to receive them</p>
  </header>

  <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
  <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>

  <div *ngIf="notificationSettings()">
    <!-- Contact Information Section -->
    <section class="form-section">
      <h3>Contact Information</h3>
      <div class="contact-fields">
        <div class="form-group">
          <label for="primaryEmail">Primary Email Address</label>
          <input
            id="primaryEmail"
            type="email"
            class="form-input"
            [value]="notificationSettings()?.primaryEmail || ''"
            (input)="onPrimaryEmailChange($any($event.target).value)"
            placeholder="your@email.com">
        </div>

        <div class="form-group">
          <label for="phoneNumber">Phone Number (for SMS notifications)</label>
          <input
            id="phoneNumber"
            type="tel"
            class="form-input"
            [value]="notificationSettings()?.phoneNumber || ''"
            (input)="onPhoneNumberChange($any($event.target).value)"
            placeholder="(555) 123-4567">
        </div>
      </div>
    </section>

    <!-- Notification Preferences Grid -->
    <section class="form-section">
      <h3>Notification Preferences</h3>

      <div class="notification-grid">
        <div class="grid-header">
          <div class="notification-type-header">Type</div>
          <div class="channel-header">Email</div>
          <div class="channel-header">SMS</div>
          <div class="channel-header">System</div>
        </div>

        <!-- Business Operations -->
        <div class="notification-category">
          <div class="category-title">Business Operations</div>
        </div>

        <div class="notification-row" *ngFor="let notification of businessNotifications; trackBy: trackByNotificationKey">
          <div class="notification-type">
            <div class="notification-name" [title]="notification.description">{{ notification.name }}</div>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isEmailEnabled(notification.key)"
                   (change)="onEmailPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'email_' + notification.key">
            <label [for]="'email_' + notification.key" class="sr-only">Email notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSmsEnabled(notification.key)"
                   (change)="onSmsPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'sms_' + notification.key"
                   [disabled]="!notificationSettings()?.phoneNumber">
            <label [for]="'sms_' + notification.key" class="sr-only">SMS notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSystemEnabled(notification.key)"
                   (change)="onSystemPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'system_' + notification.key">
            <label [for]="'system_' + notification.key" class="sr-only">System notifications for {{ notification.name }}</label>
          </div>
        </div>

        <!-- Consignor Activity -->
        <div class="notification-category">
          <div class="category-title">Consignor Activity</div>
        </div>

        <!-- All consignor notifications including separate Daily/Weekly Payout Ready -->
        <div class="notification-row" *ngFor="let notification of consignorNotifications; trackBy: trackByNotificationKey"
             [class.weekly-payout-row]="notification.key === 'weekly_payout_ready'">
          <div class="notification-type">
            <div class="notification-name" [title]="notification.description">{{ notification.name }}</div>
            <!-- Day selector for Weekly Payout Ready -->
            <div *ngIf="notification.key === 'weekly_payout_ready'" class="weekly-day-inline">
              <label for="weeklyPayoutDayInline" class="day-selector-label">Day:</label>
              <select
                id="weeklyPayoutDayInline"
                class="day-select-inline"
                [value]="getWeeklyPayoutDay()"
                (change)="onWeeklyPayoutDayChange($any($event.target).value)">
                <option value="monday">Mon</option>
                <option value="tuesday">Tue</option>
                <option value="wednesday">Wed</option>
                <option value="thursday">Thu</option>
                <option value="friday">Fri</option>
                <option value="saturday">Sat</option>
                <option value="sunday">Sun</option>
              </select>
            </div>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isEmailEnabled(notification.key)"
                   (change)="onEmailPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'email_' + notification.key">
            <label [for]="'email_' + notification.key" class="sr-only">Email notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSmsEnabled(notification.key)"
                   (change)="onSmsPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'sms_' + notification.key"
                   [disabled]="!notificationSettings()?.phoneNumber">
            <label [for]="'sms_' + notification.key" class="sr-only">SMS notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSystemEnabled(notification.key)"
                   (change)="onSystemPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'system_' + notification.key">
            <label [for]="'system_' + notification.key" class="sr-only">System notifications for {{ notification.name }}</label>
          </div>
        </div>

        <!-- Sales & Inventory -->
        <div class="notification-category">
          <div class="category-title">Sales & Inventory</div>
        </div>

        <div class="notification-row" *ngFor="let notification of salesNotifications; trackBy: trackByNotificationKey">
          <div class="notification-type">
            <div class="notification-name" [title]="notification.description">{{ notification.name }}</div>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isEmailEnabled(notification.key)"
                   (change)="onEmailPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'email_' + notification.key">
            <label [for]="'email_' + notification.key" class="sr-only">Email notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSmsEnabled(notification.key)"
                   (change)="onSmsPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'sms_' + notification.key"
                   [disabled]="!notificationSettings()?.phoneNumber">
            <label [for]="'sms_' + notification.key" class="sr-only">SMS notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSystemEnabled(notification.key)"
                   (change)="onSystemPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'system_' + notification.key">
            <label [for]="'system_' + notification.key" class="sr-only">System notifications for {{ notification.name }}</label>
          </div>
        </div>

        <!-- System Alerts -->
        <div class="notification-category">
          <div class="category-title">System Alerts</div>
        </div>

        <div class="notification-row" *ngFor="let notification of systemNotifications; trackBy: trackByNotificationKey">
          <div class="notification-type">
            <div class="notification-name" [title]="notification.description">{{ notification.name }}</div>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isEmailEnabled(notification.key)"
                   (change)="onEmailPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'email_' + notification.key">
            <label [for]="'email_' + notification.key" class="sr-only">Email notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSmsEnabled(notification.key)"
                   (change)="onSmsPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'sms_' + notification.key"
                   [disabled]="!notificationSettings()?.phoneNumber">
            <label [for]="'sms_' + notification.key" class="sr-only">SMS notifications for {{ notification.name }}</label>
          </div>
          <div class="notification-channel">
            <input type="checkbox"
                   [checked]="isSystemEnabled(notification.key)"
                   (change)="onSystemPreferenceChange(notification.key, $any($event.target).checked)"
                   [id]="'system_' + notification.key"
                   [disabled]="isSystemNotificationDisabled(notification.key)"
                   [title]="isSystemNotificationDisabled(notification.key) ? 'System alerts must be enabled for system notifications' : ''">
            <label [for]="'system_' + notification.key" class="sr-only">System notifications for {{ notification.name }}</label>
          </div>
        </div>
      </div>

    </section>

    <!-- Threshold Settings -->
    <section class="form-section">
      <h3>Notification Thresholds</h3>

      <div class="threshold-fields">
        <div class="form-group">
          <label for="highValueThreshold">High Value Sale Threshold ($)</label>
          <input
            id="highValueThreshold"
            type="number"
            min="0"
            step="1"
            class="form-input"
            [value]="notificationSettings()?.thresholds?.highValueSale || 500"
            (input)="onHighValueThresholdChange(+$any($event.target).value)"
            placeholder="500">
          <div class="field-help">Get notified when a single sale exceeds this amount</div>
        </div>

        <div class="form-group">
          <label for="lowInventoryThreshold">Low Inventory Alert Threshold</label>
          <input
            id="lowInventoryThreshold"
            type="number"
            min="0"
            step="1"
            class="form-input"
            [value]="notificationSettings()?.thresholds?.lowInventory || 10"
            (input)="onLowInventoryThresholdChange(+$any($event.target).value)"
            placeholder="10">
          <div class="field-help">Get notified when inventory drops below this number of items</div>
        </div>
      </div>
    </section>
  </div>

  <!-- Loading state -->
  <div *ngIf="!notificationSettings()" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading notification settings...</p>
  </div>
</div>