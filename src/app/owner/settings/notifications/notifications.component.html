<div class="notifications-section">
  <header class="section-header">
    <h2 class="section-title">Notification Settings</h2>
    <p class="section-description">Choose which notifications you want to receive and how you want to receive them</p>
    <div class="auto-save-status">{{ autoSaveStatus() }}</div>
  </header>

  <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
  <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>

  <div *ngIf="notificationSettings()">
    <!-- Contact Information Section -->
    <section class="form-section">
      <h3>Contact Information</h3>
      <div class="contact-fields">
        <div class="form-group">
          <label for="primaryEmail">Primary Email Address</label>
          <input
            id="primaryEmail"
            type="email"
            class="form-input"
            [value]="notificationSettings()?.contactInfo?.primaryEmailAddress || ''"
            (input)="onPrimaryEmailChange($any($event.target).value)"
            placeholder="your@email.com">
        </div>

        <div class="form-group">
          <label for="phoneNumber">Phone Number (for SMS notifications)</label>
          <input
            id="phoneNumber"
            type="tel"
            class="form-input"
            [value]="notificationSettings()?.contactInfo?.phoneNumber || ''"
            (input)="onPhoneNumberChange($any($event.target).value)"
            placeholder="(555) 123-4567">
        </div>
      </div>
    </section>

    <!-- Notification Preferences Grid -->
    <section class="form-section">
      <h3>Notification Preferences</h3>

      <div class="notification-grid">
        <div class="grid-header">
          <div class="notification-type-header">Type</div>
          <div class="channel-header">Email</div>
          <div class="channel-header">SMS</div>
          <div class="channel-header">System</div>
        </div>

        <!-- Dynamic Categories from API -->
        <ng-container *ngFor="let category of notificationSettings()?.notificationPreferences; trackBy: trackByCategory">
          <div class="notification-category">
            <div class="category-title">{{ category.categoryName }}</div>
          </div>

          <div class="notification-row" *ngFor="let event of category.events; trackBy: trackByEvent">
            <div class="notification-type">
              <div class="notification-name">{{ event.eventName }}</div>
            </div>
            <div class="notification-channel">
              <input type="checkbox"
                     [checked]="event.email"
                     (change)="onNotificationToggle(category.categoryName, event.eventName, 'email', $any($event.target).checked)"
                     [id]="'email_' + category.categoryName + '_' + event.eventName">
              <label [for]="'email_' + category.categoryName + '_' + event.eventName" class="sr-only">Email notifications for {{ event.eventName }}</label>
            </div>
            <div class="notification-channel">
              <input type="checkbox"
                     [checked]="event.sms"
                     (change)="onNotificationToggle(category.categoryName, event.eventName, 'sms', $any($event.target).checked)"
                     [id]="'sms_' + category.categoryName + '_' + event.eventName"
                     [disabled]="!notificationSettings()?.contactInfo?.phoneNumber">
              <label [for]="'sms_' + category.categoryName + '_' + event.eventName" class="sr-only">SMS notifications for {{ event.eventName }}</label>
            </div>
            <div class="notification-channel">
              <input type="checkbox"
                     [checked]="event.system"
                     (change)="onNotificationToggle(category.categoryName, event.eventName, 'system', $any($event.target).checked)"
                     [id]="'system_' + category.categoryName + '_' + event.eventName">
              <label [for]="'system_' + category.categoryName + '_' + event.eventName" class="sr-only">System notifications for {{ event.eventName }}</label>
            </div>
          </div>
        </ng-container>
      </div>

    </section>

    <!-- Threshold Settings -->
    <section class="form-section">
      <h3>Notification Thresholds</h3>

      <div class="threshold-fields">
        <div class="form-group">
          <label for="highValueThreshold">High Value Sale Threshold ($)</label>
          <input
            id="highValueThreshold"
            type="number"
            min="0"
            step="1"
            class="form-input"
            [value]="notificationSettings()?.thresholds?.highValueSaleThreshold || 500"
            (input)="onHighValueThresholdChange(+$any($event.target).value)"
            placeholder="500">
          <div class="field-help">Get notified when a single sale exceeds this amount</div>
        </div>

        <div class="form-group">
          <label for="lowInventoryThreshold">Low Inventory Alert Threshold</label>
          <input
            id="lowInventoryThreshold"
            type="number"
            min="0"
            step="1"
            class="form-input"
            [value]="notificationSettings()?.thresholds?.lowInventoryAlertThreshold || 10"
            (input)="onLowInventoryThresholdChange(+$any($event.target).value)"
            placeholder="10">
          <div class="field-help">Get notified when inventory drops below this number of items</div>
        </div>
      </div>
    </section>
  </div>

  <!-- Loading state -->
  <div *ngIf="!notificationSettings()" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading notification settings...</p>
  </div>
</div>