<div class="tax-settings-section">
  <header class="tax-header">
    <h2>Tax Settings</h2>
    <p>Configure sales tax collection and calculation for your store</p>
  </header>

  <form [formGroup]="taxForm" *ngIf="taxForm">

    <!-- Sales Tax Rate -->
    <section class="form-section">
      <h3>Sales Tax Configuration</h3>

      <div class="form-group">
        <label for="salesTaxRate">Sales Tax Rate (%)</label>
        <div class="input-group">
          <input id="salesTaxRate" type="number" min="0" max="100"
                 step="0.01" formControlName="salesTaxRate" class="form-input">
          <span class="input-suffix">%</span>
        </div>
        <span class="help-text">Enter tax rate as percentage (e.g., 8.25 for 8.25%)</span>
      </div>

      <div class="form-group">
        <label>Tax Calculation Method</label>
        <div class="radio-group">
          <label class="radio-label">
            <input type="radio" formControlName="taxIncludedInPrices" [value]="false">
            <span class="radio-mark"></span>
            Tax-exclusive (add tax to displayed prices)
          </label>
          <label class="radio-label">
            <input type="radio" formControlName="taxIncludedInPrices" [value]="true">
            <span class="radio-mark"></span>
            Tax-inclusive (displayed prices include tax)
          </label>
        </div>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="chargeTaxOnShipping">
          <span class="checkmark"></span>
          Charge tax on shipping costs
        </label>
      </div>

      <div class="calculation-preview">
        <h4>Calculation Preview</h4>
        <div class="preview-example">
          <span class="label">Item price: $100.00</span>
          <div class="calculation" *ngIf="!taxForm.get('taxIncludedInPrices')?.value">
            + Tax ({{ taxForm.get('salesTaxRate')?.value || 0 }}%): ${{ calculateTax(100) }}<br>
            <strong>Total: ${{ calculateTotal(100) }}</strong><br>
            <span class="consignment-split">Payout: ${{ calculateConsignmentPayout(100) }} (50% of pre-tax amount)</span>
          </div>
          <div class="calculation" *ngIf="taxForm.get('taxIncludedInPrices')?.value">
            (includes ${{ calculateIncludedTax(100) }} tax)<br>
            <strong>Customer pays: $100.00</strong><br>
            <span class="consignment-split">Payout: ${{ calculateInclusiveConsignmentPayout(100) }} (50% of pre-tax amount)</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Business Tax Information -->
    <section class="form-section">
      <h3>Business Tax Information</h3>

      <div class="form-group">
        <label for="taxIdEin">Federal Tax ID (EIN)</label>
        <input id="taxIdEin" type="text" formControlName="taxIdEin"
               placeholder="XX-XXXXXXX" class="form-input">
        <span class="help-text">Your business federal tax identification number</span>
      </div>
    </section>

    <div class="form-actions">
      <button type="button" (click)="previewTaxCalculation()" class="btn-secondary">
        Preview Tax Impact
      </button>
    </div>
  </form>

  <!-- Messages -->
  <div class="messages" *ngIf="errorMessage()">
    <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>
  </div>
</div>