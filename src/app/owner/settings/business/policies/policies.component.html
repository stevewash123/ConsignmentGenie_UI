<div class="policies-section">
  <header class="settings-header">
    <h2>Business Policies</h2>
    <p>Configure store policies and operational guidelines for customers and staff</p>
  </header>

  <form [formGroup]="policiesForm()" (ngSubmit)="onSave()" class="settings-form">

    <!-- Store Hours -->
    <section class="form-section" formGroupName="storeHours">
      <h3>Store Hours</h3>

      <div class="hours-schedule compact" formGroupName="schedule">
        <div *ngFor="let day of weekDays" class="day-hours-compact" [formGroupName]="day">
          <div class="day-row">
            <span class="day-label">{{ day.slice(0, 3) }}</span>
            <label class="open-toggle">
              <input type="checkbox" formControlName="isOpen">
              Open
            </label>
            <div class="time-inputs" *ngIf="policiesForm().get('storeHours.schedule.' + day + '.isOpen')?.value">
              <input type="time" formControlName="openTime" class="time-input">
              <span class="time-sep">-</span>
              <input type="time" formControlName="closeTime" class="time-input">
            </div>
            <span class="closed-text" *ngIf="!policiesForm().get('storeHours.schedule.' + day + '.isOpen')?.value">Closed</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="timezone">Time Zone</label>
        <select id="timezone" formControlName="timezone" class="form-select">
          <option value="EST">Eastern Time (EST/EDT)</option>
          <option value="CST">Central Time (CST/CDT)</option>
          <option value="MST">Mountain Time (MST/MDT)</option>
          <option value="PST">Pacific Time (PST/PDT)</option>
        </select>
      </div>

    </section>


    <!-- Returns & Exchanges -->
    <section class="form-section" formGroupName="returns">
      <h3>Returns & Exchanges</h3>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="noReturns">
          <span class="checkmark"></span>
          No returns accepted (all sales final)
        </label>
      </div>

      <div class="returns-details" *ngIf="!policiesForm().get('returns.noReturns')?.value">
        <div class="form-group">
          <label for="periodDays">Return period</label>
          <div class="input-group">
            <input
              id="periodDays"
              type="number"
              min="0"
              max="365"
              formControlName="periodDays"
              class="form-input">
            <span class="input-suffix">days</span>
          </div>
          <span class="help-text">Number of days customers can return items</span>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="requiresReceipt">
            <span class="checkmark"></span>
            Receipt required for returns
          </label>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="acceptsExchanges">
            <span class="checkmark"></span>
            Accept exchanges for different items
          </label>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="storeCreditOnly">
            <span class="checkmark"></span>
            Store credit only (no cash refunds)
          </label>
        </div>

      </div>
    </section>

    <!-- Payment Policies -->
    <section class="form-section" formGroupName="payments">
      <h3>Payment Policies</h3>

      <div class="form-group">
        <label>Accepted payment methods</label>
        <div class="payment-methods" formArrayName="acceptedMethods">
          <label *ngFor="let method of paymentMethods; let i = index" class="checkbox-label">
            <input type="checkbox" [formControlName]="i">
            <span class="checkmark"></span>
            {{ method | titlecase }}
            <span *ngIf="method === 'mobile'" class="help-text">(Apple Pay, Google Pay, etc.)</span>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="layawayAvailable">
          <span class="checkmark"></span>
          Layaway/hold service available
        </label>
      </div>

      <div class="form-group" *ngIf="policiesForm().get('payments.layawayAvailable')?.value">
        <label for="layawayTerms">Layaway terms</label>
        <textarea
          id="layawayTerms"
          formControlName="layawayTerms"
          placeholder="50% down payment, 30-day hold period, non-refundable..."
          maxlength="300"
          class="form-textarea"
          rows="3"></textarea>
      </div>

    </section>

    <!-- Consignor Policies -->
    <section class="form-section" formGroupName="consignorPolicies">
      <h3>Consignor Policies</h3>

      <div class="form-group">
        <label for="policies">Consignor policies and guidelines</label>
        <textarea
          id="policies"
          formControlName="policies"
          placeholder="Describe your consignor policies including item acceptance criteria, condition requirements, brand restrictions, seasonal guidelines, commission rates, payment terms, etc..."
          maxlength="1000"
          class="form-textarea"
          rows="8"></textarea>
        <span class="char-count">{{ consignorPoliciesLength() }}/1000 characters</span>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="notifyOnRegistration">
          <span class="checkmark"></span>
          Send policies to consignors when they register
        </label>
        <span class="help-text">When checked, new consignors will receive these policies via email after registration</span>
      </div>
    </section>



    <div class="form-actions">
      <button type="button" (click)="previewPolicies()" class="btn-secondary">
        Preview Customer View
      </button>
      <button type="submit" [disabled]="policiesForm().invalid || saving()" class="btn-primary">
        {{ saving() ? 'Saving...' : 'Save Policies' }}
      </button>
    </div>
  </form>

  <!-- Messages -->
  <div class="messages" *ngIf="successMessage() || errorMessage()">
    <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
    <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>
  </div>
</div>