<div class="policies-section">
  <header class="settings-header">
    <h2>Business Policies</h2>
    <p>Configure store policies and operational guidelines for customers and staff</p>
  </header>

  <form [formGroup]="policiesForm()" (ngSubmit)="onSave()" class="settings-form">

    <!-- Store Hours -->
    <section class="form-section" formGroupName="storeHours">
      <h3>Store Hours</h3>

      <div class="hours-schedule compact" formGroupName="schedule">
        <div *ngFor="let day of weekDays" class="day-hours-compact" [formGroupName]="day">
          <div class="day-row">
            <span class="day-label">{{ day.slice(0, 3) }}</span>
            <label class="open-toggle">
              <input type="checkbox" formControlName="isOpen">
              Open
            </label>
            <div class="time-inputs" *ngIf="policiesForm().get('storeHours.schedule.' + day + '.isOpen')?.value">
              <input type="time" formControlName="openTime" class="time-input">
              <span class="time-sep">-</span>
              <input type="time" formControlName="closeTime" class="time-input">
            </div>
            <span class="closed-text" *ngIf="!policiesForm().get('storeHours.schedule.' + day + '.isOpen')?.value">Closed</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="timezone">Time Zone</label>
        <select id="timezone" formControlName="timezone" class="form-select">
          <option value="EST">Eastern Time (EST/EDT)</option>
          <option value="CST">Central Time (CST/CDT)</option>
          <option value="MST">Mountain Time (MST/MDT)</option>
          <option value="PST">Pacific Time (PST/PDT)</option>
        </select>
      </div>

    </section>


    <!-- Returns & Exchanges -->
    <section class="form-section" formGroupName="returns">
      <h3>Returns & Exchanges</h3>

      <div class="returns-section">
        <!-- Return Policy -->
        <div class="form-group">
          <label class="form-label">Return Policy</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" value="none" [formControlName]="'returnPolicy'" (change)="onReturnPolicyChange('none')">
              <span class="radio-mark"></span>
              No returns (all sales final)
            </label>
            <label class="radio-label">
              <input type="radio" value="days" [formControlName]="'returnPolicy'" (change)="onReturnPolicyChange('days')">
              <span class="radio-mark"></span>
              Returns within
              <input
                type="number"
                min="1"
                max="365"
                [formControlName]="'periodDays'"
                [disabled]="policiesForm().get('returns.returnPolicy')?.value !== 'days'"
                class="inline-number-input">
              days
            </label>
          </div>
        </div>

        <!-- What customers can receive (only show if returns allowed) -->
        <div class="form-group" *ngIf="policiesForm().get('returns.returnPolicy')?.value === 'days'">
          <label class="form-label">What can customers receive?</label>
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="allowRefunds">
              <span class="checkmark"></span>
              Refunds (money back)
            </label>
            <label class="checkbox-label">
              <input type="checkbox" formControlName="allowExchanges">
              <span class="checkmark"></span>
              Exchanges (different item)
            </label>
            <label class="checkbox-label">
              <input type="checkbox" formControlName="allowStoreCredit">
              <span class="checkmark"></span>
              Store credit
            </label>
          </div>
        </div>

        <!-- Receipt Policy (only show if returns allowed) -->
        <div class="form-group" *ngIf="policiesForm().get('returns.returnPolicy')?.value === 'days'">
          <label class="form-label">Receipt Policy</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" value="required" [formControlName]="'receiptPolicy'">
              <span class="radio-mark"></span>
              Receipt required for all returns
            </label>
            <label class="radio-label">
              <input type="radio" value="flexible" [formControlName]="'receiptPolicy'">
              <span class="radio-mark"></span>
              Receipt preferred but not required
            </label>
            <label class="checkbox-label no-receipt-option"
                   *ngIf="policiesForm().get('returns.receiptPolicy')?.value === 'flexible' &&
                          policiesForm().get('returns.allowStoreCredit')?.value">
              <input type="checkbox" formControlName="noReceiptStoreCreditOnly">
              <span class="checkmark"></span>
              No receipt = store credit only
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- Payment Policies -->
    <section class="form-section" formGroupName="payments">
      <h3>Payment Policies</h3>

      <div class="form-group">
        <label>Accepted payment methods</label>
        <div class="payment-methods" formArrayName="acceptedMethods">
          <label *ngFor="let method of paymentMethods; let i = index" class="checkbox-label">
            <input type="checkbox" [formControlName]="i">
            <span class="checkmark"></span>
            {{ method | titlecase }}
            <span *ngIf="method === 'mobile'" class="help-text">(Apple Pay, Google Pay, etc.)</span>
          </label>
        </div>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="layawayAvailable">
          <span class="checkmark"></span>
          Layaway/hold service available
        </label>
      </div>

      <div class="form-group" *ngIf="policiesForm().get('payments.layawayAvailable')?.value">
        <label for="layawayTerms">Layaway terms</label>
        <textarea
          id="layawayTerms"
          formControlName="layawayTerms"
          placeholder="50% down payment, 30-day hold period, non-refundable..."
          maxlength="300"
          class="form-textarea"
          rows="3"></textarea>
      </div>

    </section>




    <div class="form-actions">
      <button type="button" (click)="previewPolicies()" class="btn-secondary">
        Preview Customer View
      </button>
      <button type="submit" [disabled]="policiesForm().invalid || saving()" class="btn-primary">
        {{ saving() ? 'Saving...' : 'Save Policies' }}
      </button>
    </div>
  </form>

  <!-- Messages -->
  <div class="messages" *ngIf="successMessage() || errorMessage()">
    <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
    <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>
  </div>
</div>