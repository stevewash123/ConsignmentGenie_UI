<div class="quickbooks-integration">
  <!-- Header -->
  <div class="settings-header">
    <div class="header-content">
      <h1>QuickBooks Integration</h1>
      <div class="auto-save-indicator">
        @if (isSaving()) {
          <div class="saving-indicator">
            <div class="spinner"></div>
            <span>Saving...</span>
          </div>
        } @else {
          <span class="auto-save-text">Saved automatically</span>
        }
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading integrations...</p>
    </div>
  }

  <!-- Settings Content -->
  <div class="settings-content">

    <!-- Connection Section -->
    <section class="settings-section">
      <div class="section-header">
        <h2>CONNECTION</h2>
      </div>

      @if (!quickBooksStatus().isConnected) {
        <!-- Not Connected State -->
        <div class="connection-setup">
          <button
            class="connect-button"
            (click)="connectQuickBooks()"
            [disabled]="isLoading()">
            @if (isLoading()) {
              <div class="spinner"></div>
              Connecting...
            } @else {
              Connect to QuickBooks
            }
          </button>

          <div class="connection-info">
            <i class="info-icon">ℹ️</i>
            <span>Opens QuickBooks authorization to link your account</span>
          </div>
        </div>
      } @else {
        <!-- Connected State -->
        <div class="connection-status">
          <div class="status-info">
            <div class="status-icon">✓</div>
            <div class="status-details">
              <h3>Connected: {{ quickBooksStatus().companyName || 'QuickBooks Company' }}</h3>
              <p>Company ID: {{ quickBooksStatus().companyId }}</p>
            </div>
            <button
              class="disconnect-button"
              (click)="disconnectQuickBooks()">
              Disconnect
            </button>
          </div>
        </div>
      }
    </section>

    @if (quickBooksStatus().isConnected) {
      <!-- Sales Sync Section -->
      <section class="settings-section">
        <div class="section-header">
          <h2>SALES SYNC</h2>
        </div>

        <div class="sync-option">
          <label class="sync-checkbox">
            <input
              type="checkbox"
              [checked]="salesSyncEnabled()"
              (change)="onSalesSyncToggle()"
            />
            <span class="checkmark"></span>
            <span class="sync-label">Sync sales to QuickBooks</span>
          </label>

          <div class="sync-info">
            <i class="info-icon">ℹ️</i>
            <span>Creates revenue entries when sales are recorded. Disable if Square already syncs sales to QuickBooks.</span>
          </div>
        </div>
      </section>

      <!-- Consignor Sync Section -->
      <section class="settings-section">
        <div class="section-header">
          <h2>CONSIGNOR SYNC</h2>
        </div>

        <div class="sync-option">
          <label class="sync-checkbox">
            <input
              type="checkbox"
              [checked]="consignorSyncEnabled()"
              (change)="onConsignorSyncToggle()"
            />
            <span class="checkmark"></span>
            <span class="sync-label">Sync consignors as Vendors in QuickBooks</span>
          </label>

          <div class="sync-info">
            <i class="info-icon">ℹ️</i>
            <span>Automatically creates a Vendor when a consignor is added</span>
          </div>
        </div>
      </section>

      <!-- Payout Recording Section -->
      <section class="settings-section">
        <div class="section-header">
          <h2>PAYOUT RECORDING</h2>
          <p class="section-description">How should payouts be recorded?</p>
        </div>

        <div class="recording-options">
          <label class="recording-option">
            <input
              type="radio"
              name="payoutRecording"
              value="bill-payment"
              [checked]="payoutRecordingMethod() === 'bill-payment'"
              (change)="onPayoutRecordingChange('bill-payment')"
            />
            <span class="radio-button"></span>
            <div class="option-content">
              <span class="option-label">Bill + Bill Payment (two-step)</span>
              <span class="option-description">Creates Bill when payout generated, Payment when paid</span>
            </div>
          </label>

          <label class="recording-option">
            <input
              type="radio"
              name="payoutRecording"
              value="direct-expense"
              [checked]="payoutRecordingMethod() === 'direct-expense'"
              (change)="onPayoutRecordingChange('direct-expense')"
            />
            <span class="radio-button"></span>
            <div class="option-content">
              <span class="option-label">Direct Expense (single transaction)</span>
              <span class="option-description">Records payment when payout is marked Paid</span>
            </div>
          </label>
        </div>
      </section>

      <!-- Line Item Detail Section -->
      <section class="settings-section">
        <div class="section-header">
          <h2>LINE ITEM DETAIL</h2>
        </div>

        <div class="detail-options">
          <label class="detail-option">
            <input
              type="radio"
              name="lineItemDetail"
              value="lump-sum"
              [checked]="lineItemDetail() === 'lump-sum'"
              (change)="onLineItemDetailChange('lump-sum')"
            />
            <span class="radio-button"></span>
            <div class="option-content">
              <span class="option-label">Lump sum (single line per payout)</span>
            </div>
          </label>

          <label class="detail-option">
            <input
              type="radio"
              name="lineItemDetail"
              value="itemized"
              [checked]="lineItemDetail() === 'itemized'"
              (change)="onLineItemDetailChange('itemized')"
            />
            <span class="radio-button"></span>
            <div class="option-content">
              <span class="option-label">Itemized (one line per sold item)</span>
              <span class="option-description">More detail but verbose for large payouts</span>
            </div>
          </label>
        </div>
      </section>

      <!-- Sync Status Section -->
      <section class="settings-section">
        <div class="section-header">
          <h2>SYNC STATUS</h2>
        </div>

        <div class="sync-status">
          <div class="sync-item">
            <span class="sync-label">Last Sync:</span>
            <span class="sync-value">{{ formatDate(quickBooksStatus().lastSync) || 'Never' }}</span>
          </div>
          <div class="sync-item">
            <span class="sync-label">Sync Frequency:</span>
            <span class="sync-value">{{ getSyncFrequencyDisplay() }}</span>
          </div>
        </div>

        <div class="sync-actions">
          <button
            class="btn btn-secondary"
            (click)="syncQuickBooksNow()"
            [disabled]="isLoading()">
            {{ isLoading() ? 'Syncing...' : 'Sync Now' }}
          </button>
        </div>
      </section>
    }

    @if (quickBooksStatus().error) {
      <section class="settings-section error-section">
        <div class="error-message">
          <span class="error-icon">⚠️</span>
          <span>{{ quickBooksStatus().error }}</span>
        </div>
      </section>
    }
  </div>
</div>
