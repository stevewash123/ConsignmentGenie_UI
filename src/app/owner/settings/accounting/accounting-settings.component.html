
<div class="accounting-settings">
  <div class="settings-header">
    <h2>Accounting & Bookkeeping</h2>
    <p>Configure accounting integrations, reports, and export settings for your financial records</p>
  </div>

  <form (ngSubmit)="saveSettings()" class="settings-form" *ngIf="settings()">
    <!-- QuickBooks Integration -->
    <div class="form-section">
      <h3>QuickBooks Integration</h3>

      <div class="integration-status" [class.connected]="settings()!.quickBooks.isConnected">
        <div class="status-indicator">
          <span class="status-dot" [class.active]="settings()!.quickBooks.isConnected"></span>
          <span class="status-text">
            {{ settings()!.quickBooks.isConnected ? 'Connected' : 'Not Connected' }}
          </span>
        </div>

        <div *ngIf="settings()!.quickBooks.isConnected" class="connection-info">
          <p><strong>Company:</strong> {{ settings()!.quickBooks.companyName || 'Unknown' }}</p>
          <p><strong>Company ID:</strong> {{ settings()!.quickBooks.companyId }}</p>
        </div>
      </div>

      <div class="form-group">
        <button
          type="button"
          (click)="settings()!.quickBooks.isConnected ? disconnectQuickBooks() : connectQuickBooks()"
          class="btn"
          [class.btn-danger]="settings()!.quickBooks.isConnected"
          [class.btn-primary]="!settings()!.quickBooks.isConnected">
          {{ settings()!.quickBooks.isConnected ? 'Disconnect QuickBooks' : 'Connect to QuickBooks' }}
        </button>
      </div>

      <div *ngIf="settings()!.quickBooks.isConnected" class="sync-settings">
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="settings()!.quickBooks.autoSync"
              name="autoSync">
            <span class="checkmark"></span>
            Enable automatic synchronization
          </label>
        </div>

        <div class="form-group" *ngIf="settings()!.quickBooks.autoSync">
          <label for="syncFrequency">Sync Frequency</label>
          <select
            id="syncFrequency"
            [(ngModel)]="settings()!.quickBooks.syncFrequency"
            name="syncFrequency"
            class="form-select">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="manual">Manual Only</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Report Settings -->
    <div class="form-section">
      <h3>Automated Reports</h3>

      <div class="checkbox-group">
        <label class="checkbox-label">
          <input
            type="checkbox"
            [(ngModel)]="settings()!.reports.emailReports"
            name="emailReports">
          <span class="checkmark"></span>
          Send automated financial reports via email
        </label>
      </div>

      <div *ngIf="settings()!.reports.emailReports" class="report-config">
        <div class="form-group">
          <label for="reportFrequency">Report Frequency</label>
          <select
            id="reportFrequency"
            [(ngModel)]="settings()!.reports.reportFrequency"
            name="reportFrequency"
            class="form-select">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>

        <div class="form-group">
          <label for="recipients">Email Recipients</label>
          <textarea
            id="recipients"
            [(ngModel)]="recipientsText"
            (ngModelChange)="updateRecipients($event)"
            name="recipients"
            class="form-textarea"
            placeholder="Enter email addresses, one per line"
            rows="3"></textarea>
          <small class="form-help">Enter one email address per line</small>
        </div>
      </div>
    </div>

    <!-- Export Settings -->
    <div class="form-section">
      <h3>Export Settings</h3>

      <div class="form-group">
        <label for="exportFormat">Default Export Format</label>
        <select
          id="exportFormat"
          [(ngModel)]="settings()!.exports.format"
          name="exportFormat"
          class="form-select">
          <option value="csv">CSV (Comma Separated Values)</option>
          <option value="xlsx">Excel Spreadsheet</option>
          <option value="pdf">PDF Report</option>
        </select>
      </div>

      <div class="checkbox-group">
        <label class="checkbox-label">
          <input
            type="checkbox"
            [(ngModel)]="settings()!.exports.includeConsignorDetails"
            name="includeConsignorDetails">
          <span class="checkmark"></span>
          Include consignor details in exports
        </label>

        <label class="checkbox-label">
          <input
            type="checkbox"
            [(ngModel)]="settings()!.exports.includeTaxBreakdown"
            name="includeTaxBreakdown">
          <span class="checkmark"></span>
          Include tax breakdown in exports
        </label>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="isSaving()">
        {{ isSaving() ? 'Saving...' : 'Save Settings' }}
      </button>

      <button type="button" (click)="exportFinancialData()" class="btn btn-secondary">
        Export Financial Data
      </button>
    </div>
  </form>

  <div *ngIf="isLoading()" class="loading-state">
    <p>Loading accounting settings...</p>
  </div>
</div>