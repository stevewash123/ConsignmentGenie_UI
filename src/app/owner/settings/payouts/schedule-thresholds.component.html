<div class="schedule-thresholds-section">
  <header class="settings-header">
    <h2>Payout Schedule & Thresholds</h2>
    <p>Configure when and how payouts are calculated</p>
  </header>

  <form [formGroup]="settingsForm" (ngSubmit)="onSave()" class="settings-form">

    <!-- Payout Schedule -->
    <section class="form-section" formGroupName="schedule">
      <h3>Payout Schedule</h3>

      <div class="form-group">
        <label for="frequency">How often do you pay consignors?</label>
        <select id="frequency" formControlName="frequency" class="form-select" (change)="onFrequencyChange()">
          <option value="weekly">Weekly</option>
          <option value="biweekly">Bi-weekly</option>
          <option value="monthly">Monthly</option>
          <option value="manual">Manual only (no automatic payouts)</option>
        </select>
      </div>

      <div class="form-group" *ngIf="settingsForm.get('schedule.frequency')?.value === 'weekly'">
        <label for="dayOfWeek">Day of week for payouts</label>
        <select id="dayOfWeek" formControlName="dayOfWeek" class="form-select">
          <option *ngFor="let day of weekDays" [value]="day.value">{{ day.label }}</option>
        </select>
        <span class="help-text">Recommended: Friday for weekend processing</span>
      </div>

      <div class="form-group" *ngIf="settingsForm.get('schedule.frequency')?.value === 'monthly'">
        <label for="dayOfMonth">Day of month for payouts</label>
        <select id="dayOfMonth" formControlName="dayOfMonth" class="form-select">
          <option *ngFor="let day of monthDays" [value]="day.value">{{ day.label }}</option>
        </select>
        <span class="help-text">Note: Payouts on 29-31 will occur on the last day of shorter months</span>
      </div>

      <div class="form-row" *ngIf="settingsForm.get('schedule.frequency')?.value !== 'manual'">
        <div class="form-group">
          <label for="cutoffTime">Daily cut-off time</label>
          <input id="cutoffTime" type="time" formControlName="cutoffTime" class="form-input">
          <span class="help-text">Sales after this time are included in the next payout cycle</span>
        </div>

        <div class="form-group">
          <label for="processingDays">Processing lead time (days)</label>
          <input id="processingDays" type="number" formControlName="processingDays"
                 class="form-input" min="0" max="30" step="1">
          <span class="help-text">Days between payout calculation and payment processing</span>
        </div>
      </div>
    </section>

    <!-- Minimum Thresholds -->
    <section class="form-section" formGroupName="thresholds">
      <h3>Payout Thresholds & Hold Periods</h3>

      <div class="form-group">
        <label for="minimumAmount">Minimum payout amount</label>
        <div class="input-with-prefix">
          <span class="input-prefix">$</span>
          <input id="minimumAmount" type="number" formControlName="minimumAmount"
                 class="form-input" min="0" max="10000" step="0.01" placeholder="25.00">
        </div>
        <span class="help-text">Consignors won't receive payouts until they reach this threshold</span>
      </div>

      <div class="form-group">
        <label for="holdPeriodDays">Hold period after sale (days)</label>
        <input id="holdPeriodDays" type="number" formControlName="holdPeriodDays"
               class="form-input" min="0" max="90" step="1" placeholder="14">
        <span class="help-text">Buffer time for returns and refunds before funds are released</span>
      </div>

      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="carryoverEnabled">
          <span class="checkmark"></span>
          Automatically carry over small amounts to next payout
        </label>
        <span class="help-text">When enabled, amounts below minimum will be saved for the next payout cycle</span>

        <label class="checkbox-label">
          <input type="checkbox" formControlName="earlyPayoutForTrusted">
          <span class="checkmark"></span>
          Allow early payouts for trusted consignors
        </label>
        <span class="help-text">Enables bypassing hold period for established consignors</span>
      </div>
    </section>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="submit" [disabled]="!settingsForm.valid || saving()" class="btn-primary">
        {{ saving() ? 'Saving...' : 'Save Settings' }}
      </button>
    </div>
  </form>

  <!-- Messages -->
  <div class="messages" *ngIf="successMessage() || errorMessage()">
    <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
    <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>
  </div>
</div>