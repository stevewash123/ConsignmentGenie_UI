<div class="direct-deposit-setup">
  <div class="settings-header">
    <h2>Direct Deposit Setup</h2>
    <div class="ach-status" *ngIf="payoutSettings()">
      <span class="status-icon" [class.enabled]="achEnabled()">
        {{ achEnabled() ? '‚úÖ' : '‚ùå' }}
      </span>
      <span>{{ achEnabled() ? 'ACH Enabled' : 'ACH Disabled' }}</span>
    </div>
  </div>

  <!-- ACH Not Enabled Message -->
  <div class="not-enabled-message" *ngIf="!achEnabled()">
    <div class="message-content">
      <h3>Direct Deposit (ACH) Not Enabled</h3>
      <p>To configure direct deposit settings, you must first enable Direct Deposit (ACH) on the General settings page.</p>
      <button class="btn-primary" routerLink="../general">
        Go to General Settings
      </button>
    </div>
  </div>

  <!-- Settings Form - Only show if settings are loaded -->
  <div class="settings-form" *ngIf="payoutSettings()">

    <!-- ACH Settings - Only show if ACH is enabled -->
    <div *ngIf="achEnabled()">
      <!-- Bank Account Connection -->
      <div class="form-section">
        <h3>Bank Account</h3>

        <!-- Not Connected State -->
        <div class="bank-connection-card" *ngIf="!bankConnected()">
          <div class="connection-status-badge not-connected">
            <span class="status-icon">‚ö†Ô∏è</span>
            <span>NOT CONNECTED</span>
          </div>

          <div class="connection-icon">üè¶</div>
          <h4>Bank Account Verification</h4>
          <p>Connect your shop's bank account securely using Plaid to enable automated ACH transfers to consignors.</p>

          <button class="btn-primary connect-btn" (click)="onConnectBank()" [disabled]="connecting() || !plaidReady()">
            <span *ngIf="connecting()">‚è≥ Connecting...</span>
            <span *ngIf="!connecting() && !plaidReady()">‚è≥ Loading Plaid...</span>
            <span *ngIf="!connecting() && plaidReady()">üîó Connect Bank Account</span>
          </button>

          <div class="feature-list">
            <div class="feature-item">
              <span class="check-icon">‚úì</span>
              <span>Secure bank connection via Plaid</span>
            </div>
            <div class="feature-item">
              <span class="check-icon">‚úì</span>
              <span>Automated ACH transfers to verified accounts</span>
            </div>
            <div class="feature-item">
              <span class="check-icon">‚úì</span>
              <span>Built-in fraud protection and compliance</span>
            </div>
          </div>
        </div>

        <!-- Connected State -->
        <div class="bank-connected-card" *ngIf="bankConnected()">
          <div class="connection-status-badge connected">
            <span class="status-icon">‚úÖ</span>
            <span>CONNECTED</span>
          </div>

          <div class="connection-status">
            <span class="connected-icon">‚úì</span>
            <div class="connection-details">
              <h4>{{ connectedBank()?.bankName || 'Connected Bank Account' }}</h4>
              <p>{{ connectedBank()?.accountType }} Account {{ connectedBank()?.accountNumberMask || '‚Ä¢‚Ä¢‚Ä¢‚Ä¢****' }}</p>
              <small>Connected {{ connectedBank()?.connectedAt | date:'short' }}</small>
            </div>
            <button class="btn-secondary disconnect-btn" (click)="onDisconnectBank()">
              Disconnect
            </button>
          </div>
        </div>
      </div>

    </div>

    <!-- Future Features Info -->
    <div class="form-section" *ngIf="bankConnected()">
      <h3>What's Next?</h3>
      <div class="feature-info">
        <p>Your bank account is connected and ready for ACH transfers. Additional automation features like scheduled payouts will be available in future updates.</p>
        <div class="info-note">
          <i class="icon-info">‚ÑπÔ∏è</i>
          <span>For now, you can initiate direct deposit payouts from the Payouts section when ready.</span>
        </div>
      </div>
    </div>

  </div>

  <!-- Messages -->
  <div class="messages" *ngIf="successMessage() || errorMessage()">
    <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
    <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>
  </div>
</div>