<div class="subscription-settings">
  <header class="settings-header">
    <h2>Subscription Settings</h2>
    <p>Manage your integrations, billing preferences, and subscription options</p>
  </header>

  <div *ngIf="isLoading()" class="loading-state">
    <p>Loading subscription settings...</p>
  </div>

  <div *ngIf="!isLoading()">
    <!-- Trial Notice (if applicable) -->
    <div *ngIf="subscriptionInfo()?.isTrialActive" class="trial-notice">
      <h3>Free Trial Active</h3>
      <p *ngIf="subscriptionInfo()?.trialDaysRemaining !== undefined">
        {{ subscriptionInfo()!.trialDaysRemaining! }} days remaining.
      </p>
      <p>To manage your trial or subscription, use the billing portal below.</p>
    </div>

    <!-- Integration Configuration -->
    <section class="form-section">
      <h3>Integration Configuration</h3>
      <p>Configure your active integrations and view their status. Integration activation/deactivation is managed through your billing portal.</p>

      <div class="integrations-grid">
        <div *ngFor="let integration of availableIntegrations"
             class="integration-card"
             [class.active]="integration.isActive">

          <div class="integration-header">
            <div class="integration-info">
              <h4>{{ integration.name }}</h4>
              <div class="integration-status" *ngIf="integration.isActive">
                <span class="active-badge">Active</span>
                <span *ngIf="integration.lastSyncDate" class="last-sync">
                  Last sync: {{ integration.lastSyncDate | date:'short' }}
                </span>
              </div>
            </div>
          </div>

          <p class="integration-description">{{ integration.description }}</p>

          <div class="integration-actions">
            <button *ngIf="integration.isActive && integration.configurationRequired"
                    class="btn btn-primary"
                    (click)="configureIntegration(integration.id)">
              Configure Settings
            </button>
            <button *ngIf="integration.isActive && !integration.configurationRequired"
                    class="btn btn-outline"
                    disabled>
              No Configuration Required
            </button>
            <button *ngIf="!integration.isActive"
                    class="btn btn-outline"
                    disabled>
              Not Active - Manage via Billing Portal
            </button>
          </div>
        </div>
      </div>

      <div class="billing-portal-info">
        <p>
          <strong>Note:</strong> To add or remove integrations, use the billing portal below.
          Integration costs are automatically managed by Stripe.
        </p>
      </div>
    </section>

    <!-- Billing Portal -->
    <section class="form-section">
      <h3>Billing & Subscription Management</h3>
      <p>Manage all aspects of your ConsignmentGenie subscription through Stripe's secure billing portal.</p>

      <div class="billing-portal-info">
        <p>Through the billing portal you can:</p>
        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
          <li><strong>Add or remove integrations</strong> - Each integration is automatically billed</li>
          <li><strong>Update payment methods</strong> - Credit cards, bank accounts</li>
          <li><strong>View billing history</strong> - Download invoices and receipts</li>
          <li><strong>Update billing address</strong> - For tax and legal requirements</li>
          <li><strong>Change billing frequency</strong> - Monthly or annual billing</li>
          <li><strong>Cancel subscription</strong> - With immediate confirmation</li>
          <li><strong>Trial management</strong> - View trial status and extend if eligible</li>
        </ul>
      </div>

      <div class="form-actions">
        <button class="btn btn-primary" (click)="openBillingPortal()">
          Open Billing Portal
        </button>

        <button class="btn btn-outline" (click)="openIntegrationsSettings()">
          Integration Settings
        </button>
      </div>
    </section>
  </div>
</div>