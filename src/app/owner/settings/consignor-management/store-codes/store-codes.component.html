<div class="store-codes-section">
  <header class="section-header">
    <h2 class="section-title">Store Codes & Invitations</h2>
    <p class="section-description">Manage your store code and send invitations to consignors</p>
  </header>

  <div *ngIf="successMessage()" class="message success">{{ successMessage() }}</div>
  <div *ngIf="errorMessage()" class="message error">{{ errorMessage() }}</div>

  <div *ngIf="isLoading()" class="loading">
    <p>Loading store code information...</p>
  </div>

  <div *ngIf="!isLoading()">
    <!-- Store Code Section -->
    <section class="form-section">
      <h3>Store Code</h3>

      <div class="store-code-display" *ngIf="storeCode(); else noStoreCode">
        <div class="code-value">{{ storeCode()?.currentCode }}</div>
        <div style="color: #6b7280; font-size: 0.75rem; margin-bottom: 1rem;">
          Created: {{ storeCode()?.createdAt | date:'short' }}
          <span *ngIf="storeCode()?.expiresAt">
            | Expires: {{ storeCode()?.expiresAt | date:'short' }}
          </span>
        </div>

        <div class="form-row">
          <button type="button" (click)="copyStoreCode()" class="btn-secondary">
            Copy Store Code
          </button>
          <button type="button" (click)="copySignupUrl()" class="btn-secondary">
            Copy Signup URL
          </button>
          <button type="button" (click)="generateNewStoreCode()"
                  class="btn-primary"
                  [disabled]="isLoading()">
            {{ isLoading() ? 'Generating...' : 'Generate New Code' }}
          </button>
        </div>

        <p style="color: #6b7280; font-size: 0.75rem; margin-top: 0.5rem;">
          ⚠️ Generating a new code will invalidate the current one and any pending invitations
        </p>
      </div>

      <ng-template #noStoreCode>
        <div class="empty-state">
          <p>No store code available</p>
          <button type="button" (click)="generateNewStoreCode()"
                  class="btn-primary"
                  [disabled]="isLoading()">
            {{ isLoading() ? 'Generating...' : 'Generate Store Code' }}
          </button>
        </div>
      </ng-template>
    </section>

    <!-- Send Invitation Section -->
    <section class="form-section">
      <h3>Send Invitation</h3>

      <form [formGroup]="storeCodesForm" (ngSubmit)="sendInvitation()">
        <div class="form-group">
          <label for="newInviteEmail">Consignor Email Address</label>
          <input id="newInviteEmail"
                 type="email"
                 formControlName="newInviteEmail"
                 class="form-input"
                 [class.error]="isFieldInvalid('newInviteEmail')"
                 placeholder="artist@email.com">
          <div class="error-message" *ngIf="isFieldInvalid('newInviteEmail')">
            Please enter a valid email address
          </div>
        </div>

        <button type="submit"
                class="btn-primary"
                [disabled]="!storeCodesForm.valid || isSending()">
          {{ isSending() ? 'Sending...' : 'Send Invitation' }}
        </button>
      </form>

      <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-top: 1rem;">
        <h4 style="font-weight: 600; color: #1e293b; margin-bottom: 0.5rem;">What happens when you send an invitation?</h4>
        <ul style="color: #475569; font-size: 0.875rem; margin: 0; padding-left: 1rem;">
          <li>Email sent with your store code and signup link</li>
          <li>Invitation tracked until consignor signs up</li>
          <li>You can resend or cancel if needed</li>
        </ul>
      </div>
    </section>

    <!-- Invitations List -->
    <section class="form-section">
      <h3>Recent Invitations</h3>

      <div class="invitation-list" *ngIf="invitations().length > 0; else noInvitations">
        <div class="invitation-header">
          <div style="flex: 2;">Email Address</div>
          <div style="flex: 1;">Sent Date</div>
          <div style="flex: 1;">Status</div>
          <div style="flex: 1;">Actions</div>
        </div>

        <div class="invitation-item"
             *ngFor="let invitation of invitations(); trackBy: trackByInvitationId">
          <div class="invitation-info">
            <div class="invitation-email">{{ invitation.email }}</div>
            <div class="invitation-meta">
              Sent: {{ invitation.sentAt | date:'short' }}
              <span *ngIf="invitation.expiresAt">
                | Expires: {{ invitation.expiresAt | date:'short' }}
              </span>
            </div>
          </div>

          <div>
            <span [class]="getStatusClass(invitation.status)">
              {{ invitation.status | titlecase }}
            </span>
          </div>

          <div class="invitation-actions">
            <button *ngIf="invitation.status === 'pending'"
                    type="button"
                    (click)="resendInvitation(invitation)"
                    class="btn-secondary btn-small">
              Resend
            </button>
            <button *ngIf="invitation.status === 'pending'"
                    type="button"
                    (click)="cancelInvitation(invitation)"
                    class="btn-secondary btn-small">
              Cancel
            </button>
          </div>
        </div>
      </div>

      <ng-template #noInvitations>
        <div class="empty-state">
          <p>No invitations sent yet</p>
          <p style="font-size: 0.75rem;">Send an invitation above to get started</p>
        </div>
      </ng-template>
    </section>
  </div>
</div>