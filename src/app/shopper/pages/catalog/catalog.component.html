
    <div class="catalog-container">
      <div class="container">
        <div class="catalog-header">
          <div class="header-content">
            <h1>Shop {{ storeInfo?.name || 'Our Store' }}</h1>
            <p class="store-description" *ngIf="storeInfo?.description">
              {{ storeInfo.description }}
            </p>
          </div>
        </div>

        <div class="catalog-filters">
          <div class="search-section">
            <div class="search-input">
              <input
                type="text"
                [(ngModel)]="searchTerm"
                (input)="onSearch()"
                placeholder="Search items..."
                class="form-control">
              <button class="search-btn" (click)="onSearch()">
                üîç
              </button>
            </div>
          </div>

          <div class="filter-section">
            <select [(ngModel)]="selectedCategory" (change)="onCategoryChange()" class="form-select">
              <option value="">All Categories</option>
              <option *ngFor="let category of categories" [value]="category.name">
                {{ category.name }} ({{ category.itemCount }})
              </option>
            </select>

            <select [(ngModel)]="sortBy" (change)="onSortChange()" class="form-select">
              <option value="name">Sort by Name</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
              <option value="newest">Newest First</option>
            </select>
          </div>
        </div>

        <div class="error-message" *ngIf="error && !loadingService.isLoading(KEYS.CATALOG_ITEMS) && !loadingService.isLoading(KEYS.CATALOG_SEARCH)">
          <div class="alert alert-danger">
            {{ error }}
            <button class="btn btn-outline-primary btn-sm ms-2" (click)="loadCatalogData()">Retry</button>
          </div>
        </div>

        <div class="catalog-content" *ngIf="!loadingService.isLoading(KEYS.CATALOG_ITEMS) && !loadingService.isLoading(KEYS.CATALOG_SEARCH) && !error; else loadingTemplate">
          <div class="items-grid" *ngIf="items.length > 0; else noItemsTemplate">
            <div class="item-card" *ngFor="let item of items" data-cy="item-card">
              <div class="item-image" (click)="viewItemDetail(item)" style="cursor: pointer;">
                <img
                  [src]="item.primaryImageUrl || '/assets/placeholder-item.jpg'"
                  [alt]="item.title"
                  class="item-img"
                  (error)="onImageError($event)">
              </div>

              <div class="item-details">
                <h3 class="item-name" (click)="viewItemDetail(item)" style="cursor: pointer;">{{ item.title }}</h3>
                <p class="item-category" *ngIf="item.category">{{ item.category }}</p>
                <p class="item-brand" *ngIf="item.brand">{{ item.brand }}</p>
                <p class="item-condition">{{ item.condition }}</p>
                <p class="item-description" *ngIf="item.description">{{ item.description }}</p>
                <div class="item-footer">
                  <span class="item-price">\${{ item.price | number:'1.2-2' }}</span>
                  <button
                    class="btn btn-primary btn-sm"
                    data-cy="add-to-cart-btn"
                    (click)="addToCart(item)">
                    Add to Cart
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="pagination" *ngIf="totalPages > 1">
            <button
              class="btn btn-outline-secondary"
              [disabled]="currentPage === 1"
              (click)="goToPage(currentPage - 1)">
              Previous
            </button>

            <span class="page-info">
              Page {{ currentPage }} of {{ totalPages }} ({{ totalCount }} total items)
            </span>

            <button
              class="btn btn-outline-secondary"
              [disabled]="currentPage === totalPages"
              (click)="goToPage(currentPage + 1)">
              Next
            </button>
          </div>
        </div>

        <ng-template #loadingTemplate>
          <div class="loading-state">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p *ngIf="loadingService.isLoading(KEYS.CATALOG_SEARCH)">Searching items...</p>
            <p *ngIf="loadingService.isLoading(KEYS.CATALOG_ITEMS) && !loadingService.isLoading(KEYS.CATALOG_SEARCH)">Loading items...</p>
          </div>
        </ng-template>

        <ng-template #noItemsTemplate>
          <div class="empty-state">
            <div class="empty-icon">üì¶</div>
            <h3>No Items Found</h3>
            <p *ngIf="searchTerm || selectedCategory">
              Try adjusting your search or filter criteria.
            </p>
            <p *ngIf="!searchTerm && !selectedCategory">
              This store doesn't have any items available right now. Check back soon!
            </p>
            <button class="btn btn-outline-primary" (click)="clearFilters()">
              Clear Filters
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  