
    <div class="cart-container">
      <div class="container">
        <div class="cart-header">
          <h1>Shopping Cart</h1>
          <p class="store-name" *ngIf="storeInfo">{{ storeInfo.name }}</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="loadingService.isLoading(KEYS.CART_LOAD)" class="loading-container">
          <div class="loading-spinner"></div>
          <p>Loading cart...</p>
        </div>

        <div class="cart-content" *ngIf="!loadingService.isLoading(KEYS.CART_LOAD) && cart && cart.items.length > 0; else emptyCartTemplate">
          <div class="cart-items">
            <div class="cart-item" *ngFor="let item of cart.items; trackBy: trackByItemId" data-cy="cart-item">
              <div class="item-image">
                <img
                  [src]="item.primaryImageUrl || '/assets/placeholder-item.jpg'"
                  [alt]="item.title"
                  class="item-img"
                  (error)="onImageError($event)">
              </div>

              <div class="item-details">
                <h3 class="item-name">
                  <a [routerLink]="['/shop', storeSlug, 'items', item.itemId]" class="item-link">
                    {{ item.title }}
                  </a>
                </h3>
                <p class="item-category" *ngIf="item.category">{{ item.category }}</p>
                <p class="item-brand" *ngIf="item.brand">{{ item.brand }}</p>
                <p class="item-condition">{{ item.condition }}</p>
                <p class="item-added">Added {{ item.addedAt | date:'short' }}</p>
              </div>

              <div class="item-quantity">
                <label class="quantity-label">Qty:</label>
                <div class="quantity-controls">
                  <button
                    class="qty-btn"
                    data-cy="decrease-quantity-btn"
                    (click)="updateQuantity(item.itemId, item.quantity - 1)"
                    [disabled]="item.quantity <= 1">
                    -
                  </button>
                  <span class="quantity" data-cy="item-quantity">{{ item.quantity }}</span>
                  <button
                    class="qty-btn"
                    data-cy="increase-quantity-btn"
                    (click)="updateQuantity(item.itemId, item.quantity + 1)">
                    +
                  </button>
                </div>
              </div>

              <div class="item-price">
                <span class="price" data-cy="item-total-price">${{ (item.price * item.quantity) | number:'1.2-2' }}</span>
                <span class="unit-price" *ngIf="item.quantity > 1">
                  (${{ item.price | number:'1.2-2' }} each)
                </span>
              </div>

              <div class="item-actions">
                <button
                  class="btn btn-outline-danger btn-sm"
                  data-cy="remove-item-btn"
                  (click)="removeItem(item.itemId)">
                  Remove
                </button>
              </div>
            </div>
          </div>

          <div class="cart-summary">
            <div class="summary-card">
              <h3>Order Summary</h3>

              <div class="summary-row">
                <span>Subtotal ({{ cart.itemCount }} items)</span>
                <span data-cy="cart-subtotal">${{ cart.subtotal | number:'1.2-2' }}</span>
              </div>

              <div class="summary-row">
                <span>Tax (estimated)</span>
                <span data-cy="cart-tax">${{ cart.tax | number:'1.2-2' }}</span>
              </div>

              <div class="summary-row total">
                <span>Total</span>
                <span data-cy="cart-total">${{ cart.total | number:'1.2-2' }}</span>
              </div>

              <div class="checkout-actions">
                <button
                  class="btn btn-primary btn-block"
                  data-cy="proceed-to-checkout-btn"
                  (click)="proceedToCheckout()">
                  Proceed to Checkout
                </button>

                <button
                  class="btn btn-outline-secondary btn-block"
                  [routerLink]="['/shop', storeSlug]">
                  Continue Shopping
                </button>

                <button
                  class="btn btn-outline-warning btn-block"
                  data-cy="clear-cart-btn"
                  (click)="clearCart()"
                  *ngIf="cart.items.length > 0">
                  Clear Cart
                </button>
              </div>

              <div class="guest-notice" *ngIf="!isAuthenticated">
                <p class="notice-text">
                  ðŸ’¡ <a [routerLink]="['/shop', storeSlug, 'login']" [queryParams]="{returnUrl: '/shop/' + storeSlug + '/cart'}">
                    Sign in
                  </a> to save your cart and track your orders.
                </p>
              </div>

              <div class="cart-persistence-info">
                <p class="info-text">
                  <small>Cart last updated: {{ cart.lastUpdated | date:'medium' }}</small>
                </p>
              </div>
            </div>
          </div>
        </div>

        <ng-template #emptyCartTemplate>
          <div class="empty-cart" *ngIf="!loadingService.isLoading(KEYS.CART_LOAD)">
            <div class="empty-icon">ðŸ›’</div>
            <h2>Your cart is empty</h2>
            <p>Looks like you haven't added anything to your cart yet.</p>
            <button
              class="btn btn-primary"
              [routerLink]="['/shop', storeSlug]">
              Start Shopping
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  