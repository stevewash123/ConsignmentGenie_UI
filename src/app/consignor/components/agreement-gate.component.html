<div class="agreement-gate">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading agreement status...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error">
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{error}}</p>
    </div>
    <button class="retry-btn" (click)="loadAgreementStatus()">
      Try Again
    </button>
  </div>

  <!-- Main Content -->
  <div class="agreement-content" *ngIf="!isLoading && !error && agreementStatus">
    <!-- Agreement Status Card -->
    <div class="status-card" [ngClass]="getStatusClass()">
      <div class="status-header">
        <div class="status-icon">
          <i class="fas fa-file-signature" *ngIf="agreementStatus.status === 'approved'"></i>
          <i class="fas fa-clock" *ngIf="agreementStatus.status === 'pending_review'"></i>
          <i class="fas fa-times-circle" *ngIf="agreementStatus.status === 'rejected'"></i>
          <i class="fas fa-file-upload" *ngIf="!agreementStatus.status || agreementStatus.status === 'required'"></i>
        </div>
        <div class="status-title">
          <h2>Consignment Agreement</h2>
          <span class="status-badge" [ngClass]="getStatusClass()">
            {{agreementStatus.status === 'approved' ? 'Approved' :
              agreementStatus.status === 'pending_review' ? 'Under Review' :
              agreementStatus.status === 'rejected' ? 'Rejected' :
              'Required'}}
          </span>
        </div>
      </div>

      <div class="status-message">
        <p>{{getStatusMessage()}}</p>
        <div class="action-buttons" *ngIf="isAgreementApproved()">
          <button class="btn-primary" (click)="goToDashboard()">
            <i class="fas fa-arrow-right"></i>
            Continue to Dashboard
          </button>
        </div>
      </div>

      <!-- Agreement Details -->
      <div class="agreement-details" *ngIf="agreementStatus.latestUpload">
        <h4>Latest Upload</h4>
        <div class="upload-info">
          <div class="upload-row">
            <span class="label">Uploaded:</span>
            <span class="value">{{agreementStatus.latestUpload.uploadedAt | date:'medium'}}</span>
          </div>
          <div class="upload-row" *ngIf="agreementStatus.latestUpload.recommendation">
            <span class="label">AI Analysis:</span>
            <span class="value recommendation" [ngClass]="'rec-' + agreementStatus.latestUpload.recommendation">
              {{agreementStatus.latestUpload.recommendation === 'approve' ? 'Recommended for approval' :
                agreementStatus.latestUpload.recommendation === 'reject' ? 'Issues found' :
                'Manual review required'}}
            </span>
          </div>
          <div class="upload-row" *ngIf="agreementStatus.latestUpload.reviewedAt">
            <span class="label">Reviewed:</span>
            <span class="value">{{agreementStatus.latestUpload.reviewedAt | date:'medium'}}</span>
          </div>
          <div class="upload-row" *ngIf="agreementStatus.latestUpload.reviewNote">
            <span class="label">Review Note:</span>
            <span class="value">{{agreementStatus.latestUpload.reviewNote}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Upload Form -->
    <div class="upload-section" *ngIf="showUploadForm()">
      <div class="upload-card">
        <h3>Upload Signed Agreement</h3>
        <p class="upload-instructions">
          Please upload your signed consignment agreement. Accepted formats: PDF, Images (JPG, PNG, GIF), Word documents, or text files.
          Maximum file size: 10MB.
        </p>

        <!-- File Selection -->
        <div class="file-input-container">
          <input
            type="file"
            id="agreement-file"
            (change)="onFileSelected($event)"
            accept=".pdf,.jpg,.jpeg,.png,.gif,.txt,.doc,.docx"
            [disabled]="isUploading">
          <label for="agreement-file" class="file-input-label" [class.disabled]="isUploading">
            <i class="fas fa-cloud-upload-alt"></i>
            <span>Choose File</span>
          </label>
        </div>

        <!-- Selected File Info -->
        <div class="selected-file" *ngIf="selectedFile">
          <div class="file-info">
            <i class="fas fa-file"></i>
            <div class="file-details">
              <div class="file-name">{{selectedFile.name}}</div>
              <div class="file-size">{{formatFileSize(selectedFile.size)}}</div>
            </div>
          </div>
          <button
            class="upload-btn"
            (click)="uploadAgreement()"
            [disabled]="isUploading"
            [class.uploading]="isUploading">
            <i class="fas fa-spinner fa-spin" *ngIf="isUploading"></i>
            <i class="fas fa-upload" *ngIf="!isUploading"></i>
            {{isUploading ? 'Uploading...' : 'Upload Agreement'}}
          </button>
        </div>

        <!-- Upload Messages -->
        <div class="upload-error" *ngIf="uploadError">
          <i class="fas fa-exclamation-circle"></i>
          <span>{{uploadError}}</span>
        </div>

        <div class="upload-success" *ngIf="uploadSuccess">
          <i class="fas fa-check-circle"></i>
          <span>{{uploadSuccess}}</span>
        </div>
      </div>
    </div>

    <!-- Information Section -->
    <div class="info-section">
      <div class="info-card">
        <h4>What happens next?</h4>
        <ul class="process-steps">
          <li class="step">
            <i class="fas fa-upload"></i>
            <span>Upload your signed agreement document</span>
          </li>
          <li class="step">
            <i class="fas fa-robot"></i>
            <span>AI analyzes the document automatically</span>
          </li>
          <li class="step">
            <i class="fas fa-user-check"></i>
            <span>Shop owner reviews if needed</span>
          </li>
          <li class="step">
            <i class="fas fa-check-circle"></i>
            <span>Start submitting items for consignment</span>
          </li>
        </ul>
      </div>

      <div class="help-card" *ngIf="!isAgreementApproved()">
        <h4>Need Help?</h4>
        <p>If you haven't received your consignment agreement yet, please contact the shop directly:</p>
        <div class="contact-info">
          <strong>{{consignorProfile?.organizationName}}</strong>
        </div>
        <p class="help-note">
          Make sure to sign and date the agreement before uploading. The document should be clear and readable.
        </p>
      </div>
    </div>
  </div>
</div>